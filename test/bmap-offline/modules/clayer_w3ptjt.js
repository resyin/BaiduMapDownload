/**/_jsload2&&_jsload2('clayer', 'A.extend(qb.prototype,{Yk:{},Aj:[],pu:"",Sp:"",kG:"",Zk:q,Lg:q,Kg:q,Jg:[],jG:0,My:u(),Iy:u(),lu:u(),Rd:function(){this.rG()},ya:function(a,b){ud.prototype.ya.call(this,a,b);this.Yk={};this.Aj=[];this.P=a;this.rG()},Vs:da(p),remove:function(){ud.prototype.remove.call(this);this.oT()},rG:function(){var a=this,b=a.P;b&&(this.My=function(b){a.FS(b)},this.Iy=function(b){a.fS(b)},this.lu=function(b){a.eS(b)},b.addEventListener("mousemove",this.My),b.addEventListener("onhotspotover",this.Iy),b.addEventListener("onhotspotout", this.lu),b.addEventListener("onzoomstart",this.lu))},oT:function(){var a=this.P;a&&(a.removeEventListener("mousemove",this.My),a.removeEventListener("onhotspotover",this.Iy),a.removeEventListener("onhotspotout",this.lu))},FS:function(a){var b=this,c=b.P,e=c.wa();if(c.ja()<this.fc||c.Od())b.SA();else if(a=e.jj().zg(a.point),e=e.Id(),a=new R(Math.floor(a.x*Math.pow(2,c.ja()-18)),Math.floor(a.y*Math.pow(2,c.ja()-18))),e=new R(Math.floor(a.x/e),Math.floor(a.y/e)),this.Sp=c=e.x+"_"+e.y+"_"+c.ja(),this.Yk[c]){if(this.pu!= c){b.SA();b.qG(this.Yk[c]);this.pu=c;for(var e=-1,a=0,f=this.Aj.length;a<f;a++)if(c==this.Aj[a]){e=a;break}0<=e&&(this.Aj.splice(e,e),this.Aj.push(c))}}else if(this.kG!=c){this.kG=c;e=Cd[parseInt(Math.random()*Cd.length)];a=b.cb;c=e+"/data?grids="+c+"&q="+a.ut+"&tags="+a.cO+"&filter="+a.filter+"&sortby="+a.UN+"&ak="+a.DB+"&page_size="+a.dN+"&age="+a.wJ;b.Bf?c+="&geotable_id="+b.Bf:b.xn&&(c+="&databox_id="+b.xn);var g=(1E5*Math.random()).toFixed(0);!D._rd&&(D._rd={});D._rd["_cbk"+g]=function(a){b.YR(a); delete D._rd["_cbk"+g]};oa(c+("&callback=BMap._rd._cbk"+g))}},YR:function(a){var b=this.P,c=a.content;if(!(a.status!=this.jG||!c||1>c.length)){for(var a=[],e=c[0].data,b=b.wa().jj(),f=0,g=e.length;f<g;f++){var i=e[f][2].replace(qb.BT,"").split(","),i=b.nh(new J(i[0],i[1]));a.push({pt:i,userdata:{name:e[f][0]||"name",size:e[f][4]?e[f][4].split("|"):[10,13],uid:e[f][1]||"",Vb:e[f][3]||"sid1"}})}c=c[0].grid.join("_");this.Yk[c]=a;this.Aj.push(c);30<this.Aj.length&&(c=this.Aj.shift(),delete this.Yk[c], delete c);this.pu!=this.Sp&&(this.SA(),this.Yk[this.Sp]&&(this.qG(this.Yk[this.Sp]),this.pu=this.Sp))}},qG:function(a){for(var b=this.P,c=0,e=a.length;c<e;c++){var f=a[c].userdata.size,g=f[0]/2,f=f[1]/2,g=new kb(a[c].pt,{offsets:[f,g,f,g],userData:a[c].userdata});b.wB(g,this.cb.GD)}},SA:function(){this.P.qw(this.cb.GD)},fS:function(a){if(a.spots&&!(1>a.spots.length||a.spots[0].tag!=this.cb.GD)){this.Jg=a.spots;var b=this,a=this.Jg[0].getUserData().size[0],c="",e=b.P,f="",g=b.cb.HY;0<this.Jg.length&& (c=this.Jg[0].getUserData().name);if(this.Lg)this.Lg.va(this.Jg[0].la()),this.Kg.bd(c),this.Kg.Ld(new N(a,0)),this.Lg.show(),c?this.Kg.show():this.Kg.$();else{var i=this.Jg[0].getUserData().size,f=this.Jg[0].getUserData().Vb,k=this.Bf||this.xn;this.Zk=new Zc(H.sa+"blank.gif",new N(i[0],i[1]),{anchor:new N(i[0]/2+1,i[1]/2+1)});this.PR(k,f,function(){b.Lg&&b.Lg.Ub(b.Zk)});this.Lg=new W(this.Jg[0].la(),{icon:this.Zk,enableMassClear:t});e.Pa(this.Lg);this.Kg=new cd(c,{offset:new N(a,0)});this.Kg.Md({backgroundColor:g.backgroundColor, borderColor:g.borderColor});this.Lg.Mm(this.Kg);c?this.Kg.show():this.Kg.$();this.Lg.addEventListener("onclick",function(){if(!(b.Jg.length<1)&&b.Jg[0].getUserData().uid){var a=b.cb,c=a.ZX;if(b.Bf)c=a.$X;a=c+b.Jg[0].getUserData().uid+"?scope=2&ak="+a.DB;b.Bf&&(a=a+("&geotable_id="+b.Bf));var e=(Math.random()*1E5).toFixed(0);!D._rd&&(D._rd={});D._rd["_cbk"+e]=function(a){b.OR(a);delete D._rd["_cbk"+e]};oa(a+("&callback=BMap._rd._cbk"+e))}})}}},OR:function(a){var b=a.content;this.Bf&&(b=a.contents[0]); if(a&&a.status==this.jG&&b){var a={poiId:b.uid||"",databoxId:b.databox_id||"",title:this.Bf?b.title:b.name,address:this.Bf?b.address:b.addr,phoneNumber:b.tel||"",postcode:b.zip||"",provinceCode:1*b.province_id||-1,province:b.province||"",cityCode:1*b.city_id||-1,city:b.city||"",districtCode:1*b.district_id||-1,district:b.district||"",point:this.Bf?new J(b.location[0],b.location[1]):new J(b.longitude,b.latitude),tags:b.tag&&b.tag.replace(qb.ET,"").split(qb.CT),typeId:1*b.cla||-1,extendedData:b.ext|| {}},c=new A.lang.ku("onhotspotclick");c.customPoi=a;c.content=b;this.dispatchEvent(c)}},eS:function(){this.Lg&&this.Lg.$();this.Kg&&this.Kg.$()},PR:function(a,b,c){var e=this,f=Dd+"?method=getstyle&databox="+a+"&sid="+b,g=(1E5*Math.random()).toFixed(0);if(!e.Zk||!(e.Zk.databoxid==a&&e.Zk.sid==b))!D._rd&&(D._rd={}),D._rd["_cbk"+g]=function(a){var b="";0==a.status&&(b="data:image/png;base64,"+a.content.sid1);0<b.length&&(e.Zk.DN(b),c&&c(a));delete D._rd["_cbk"+g]},oa(f+("&callback=BMap._rd._cbk"+g))}}); ');
