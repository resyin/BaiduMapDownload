/**/_jsload2&&_jsload2('panorama', 'eg.prototype.hC=ha(2,function(){this.Pb.style[Jf]="";this.xi=this.ei=t;this.sv("h");this.sv("v");this.$d(Vf,window);this.$d(Wf);this.$d(Xf,window);this.$d(Yf,window);this.$d(Zf,window);this.options.Ak||(this.$d("DOMMouseScroll"),this.$d("mousewheel"));this.options.wi&&this.$d($f);this.options.lw&&clearInterval(this.dV);this.options.LM&&this.options.LM.call(this)});var ak=4; function bk(a,b){var c=a.width,e=a.height,f=180/Math.pow(2,b),g=1;I()&&(g=2);c=f/(1<c/e?e:c);g=Math.floor(b)+g;for(e=360/(2*Math.pow(2,g-2)*c);512<e;)g++,e=360/(2*Math.pow(2,g-2)*c);g>kf&&(e*=Math.pow(2,g-kf),g=kf);g<ak&&(g=ak);e=Math.round(e);return{JL:g,hK:e}}var ck=5063,dk=5062,ek=5061,fk=5060,kf=5,ak=4; A.extend(Pa.prototype,{mb:function(){this.yQ();for(var a=0;a<D.Wq.length;a++)D.Wq[a](this);this.fb!=q?"inter"===this.Je?this.VE(this.fb):this.dispatchEvent(new P("onid_changed")):this.Jb!=q&&(this.dispatchEvent(new P("onposition_changed")),this.dispatchEvent(new P("onposition_changed_inner")));this.m.visible?this.show():this.$();this.Mf!=q&&this.dispatchEvent(new P("onvisible_poi_type_changed"),{visiblePOIType:this.Mf});var a=q,b;for(b in this.Ie)a=this.Ie[b],delete this.Ie[b],this.Pa(a);this.$()}, Dt:function(a){this.Mf=a||"none";this.dispatchEvent(new P("onvisible_poi_type_changed"),{visiblePOIType:this.Mf})},Pa:function(a){this.Ie[a.jd]=a;this.dispatchEvent(new P("onadd_overlay"),{overlay:a})},Ob:function(a){delete this.Ie[a.jd];this.dispatchEvent(new P("onremove_overlay"),{overlay:a})},n1:function(a,b){var c=L("div"),e=c.style;c.className="pano_m_indoor_exit";c.title=a;c.onclick=b;e.display="none";e.zIndex=1201;c.innerHTML=\'<span style="float:right;margin-right:12px;">\\u51fa\\u53e3</span>\'; return c},m1:function(a,b){var c=L("div"),e=c.style;e.position="absolute";e.zIndex=1201;e.right=e.top="10px";e.width="17px";e.height="16px";e.background=\'url("\'+H.sa+\'st-close.png") no-repeat 50% 50%\';I()&&(e.right=e.top="0px",e.width="42.5px",e.height="40px",e.backgroundSize="25.5px 24px");e.cursor="pointer";c.title=a;c.onclick=b;e.display="none";return c},Cc:function(a,b,c){"object"===typeof b&&(c=b,b=l);a!=this.fb&&(this.ql=this.fb,this.rl=this._position,this.fb=a,this.Vz=q,this.Je=b||"street", c=c||{hk:t},this.bJ=c.hk,"inter"===b?this.VE(a):this.dispatchEvent(new P("onid_changed")),this.q_(c))},q_:function(a){this.hv={id:this.Wb(),pov:a.pov}},qX:function(a,b){var c,e;if(this.hv&&a===this.hv.id){c={};for(var f=0;f<b.length;f++)e=b[f],c[e]=this.hv[e];this.hv=q}return c},va:function(a,b){a.Sb(this.Jb)||(this.ql=this.fb,this.rl=this._position,this.Jb=a,this.fb=q,b=b||{hk:t},this.bJ=b.hk,this.dispatchEvent(new P("onposition_changed_inner")))},rd:function(a){var b={heading:this.Ka.heading,pitch:this.Ka.pitch}, c=a.pitch,a=a.heading,a=this.fC(a);c>this.Sj?c=this.Sj:c<this.Uj&&(c=this.Uj);this.Ka.pitch=c;this.Ka.heading=a;if(b.heading!=this.Ka.heading||b.pitch!=this.Ka.pitch)this.cr=p,this.dispatchEvent(new P("onpov_changed"))},fC:function(a){return a-360*Math.floor(a/360)},gy:function(a){var b=this.Ka,c=a.heading-b.heading,e=a.pitch-b.pitch,f=this;new wb({Ic:30,duration:200,ac:xb.zC,za:function(a){f.rd({heading:b.heading+a*c,pitch:b.pitch+a*e})},finish:function(){f.rd(a)}})},Qc:function(a,b){if(a!=this.Lc){a> hf&&(a=hf);a<jf&&(a=jf);if(a!=this.Lc){this.Lc=a;var c=new P("onzoom_changed_inner"),b=b||{};c.hp=b.hp||t;this.dispatchEvent(c);(!Oa()||c.hp)&&this.dispatchEvent(new P("onzoom_changed"))}"cssRender"===this.Fq()&&this.rd(this.Ka)}},aB:function(){if(this.P){for(var a=this.P.Zw(),b=0;b<a.length;b++)(a[b]instanceof W||a[b]instanceof cd)&&a[b].point&&this.Ba.push(a[b]);this.dispatchEvent(new P("onoverlay_changed"))}},Bk:function(){this.zl.style.visibility="hidden"},ly:function(){this.dispatchEvent(new P("onoverlay_show")); this.zl.style.visibility="visible"},show:function(){this.m.visible=p;this.Yd&&A.U.show(this.Yd);this.m.closeControl&&(this.Af&&this.P&&this.P.Ra()===this.R)&&A.U.show(this.Af);this.BA&&this.BA.show();this.aB();this.dispatchEvent(new P("onvisible_changed"))},$:function(){this.m.visible=t;this.Yd&&A.U.$(this.Yd);this.m.closeControl&&this.Af&&A.U.$(this.Af);this.BA&&this.BA.$();this.dispatchEvent(new P("onvisible_changed"))},XE:function(a){this.P=a;this.aB()},yQ:function(){var a=L("div"),b=a.style;b.overflow= "hidden";b.position="absolute";b.zIndex=1200;b.top=b.left="0px";b.height=b.width="100%";b.backgroundColor="#e5e3df";this.Yd=a;this.Ph=this.Hj("1");this.Rj=this.Hj("4");this.zl=this.Hj("5");a.appendChild(this.Ph);a.appendChild(this.Rj);a.appendChild(this.zl);Oa()||(this.Qq=this.Hj("3"),this.Qq.style.width=this.R.clientWidth+"px",this.Qq.style.height=this.R.clientHeight+"px",this.Qq.style.overflow="hidden",this.Qq.style.WebkitUserSelect="none",a.appendChild(this.Qq),tf()&&(this.Fv=this.PG(),this.Ph.appendChild(this.Fv), this.Gv=this.PG(),this.Ph.appendChild(this.Gv)));this.R.appendChild(a);"absolute"!=Xa(this.R).position&&(this.R.style.position="relative")},Hj:function(a){var b=L("div"),c=b.style;c.position="absolute";c.top=c.left="0";c.zIndex=a||"0";c.WebkitUserSelect="none";return b},PG:function(){var a=L("img");thumbStyle=a.style;thumbStyle.position="absolute";thumbStyle.top=thumbStyle.left="0";thumbStyle.zIndex="1";thumbStyle.opacity="0";thumbStyle.ac=thumbStyle.WebkitTransition="opacity 300ms ease-out";a.onload= function(){this.style.visibility="";this.style.opacity="1"};return a},Ra:x("R"),gh:function(){return new N(this.R.clientWidth,this.R.clientHeight)},E3:x("$j"),MX:x("Iv"),PN:ba("Iv"),VE:function(a){a!=this.Vz&&(this.Vz=a,this.fb=q,this.dispatchEvent(new P("oniid_changed")),this.dispatchEvent(new P("onid_changed")),Ra(5045,{type:this.m.panoramaRenderer}))},clear:function(){this.Jb=this.fb=this.ha=q;this.In=[];this.dispatchEvent(new P("onclear"))},Io:function(){var a=this.ha.Vl;this.dR=this.ha.TU;this.clear(); this.XG=p;this.Cc(a)}});var gk=Pa.prototype;V(gk,{setId:gk.Cc,setPosition:gk.va,setPov:gk.rd,setZoom:gk.Qc,show:gk.show,hide:gk.$,setPanoramaPOIType:gk.Dt,addOverlay:gk.Pa,removeOverlay:gk.Ob,exitInter:gk.Io});function hk(a){a.mg=this;var b=A.platform.pj?"android":"ios";Oa()?(this.Bd=new ik(a),this.ld=new jk(a,this.Bd.Rb),this.Bd.pU(this.ld),"android"===b?Ra(fk):Ra(ek)):(this.Bd=new kk(a),this.ld=new lk(a),"android"===b?Ra(dk):Ra(ck));a.m.linksControl?this.ld.show():this.ld.$();a.m.clickOnRoad?this.ld.DC():this.ld.lC();this.W=a;this.ga();this.US=new mk(a,this)}D.Gk(function(a){a.mg=new hk(a)});A.lang.xa(hk,A.lang.Ha,"PanoramaRenderer"); A.extend(hk.prototype,{ga:function(){var a=this.W,b=this;a.addEventListener("links_visible_changed",function(){a.m.linksControl===p?b.ld.show():b.ld.$();b.W.dispatchEvent(new P("onrefresh"))});a.addEventListener("clickonroad_changed",function(){a.m.clickOnRoad===p?b.ld.DC():b.ld.lC();b.W.dispatchEvent(new P("onrefresh"))});a.addEventListener("dataload",function(c){b.ha=c.data;b.yu();b.EI(c.data);b.za(a.Ja(),b.cf,b.$g)});a.addEventListener("pov_changed",function(){b.ha&&b.za(a.Ja(),b.cf,b.$g)});a.addEventListener("clear", function(){b.ha=q;b.EI(q);b.Bd.za();b.ld&&b.ld.za()});a.addEventListener("zoom_changed_inner",function(c){b.ha&&(b.yu(),b.LT(a.Ja(),b.cf,b.$g,c.hp))});a.addEventListener("size_changed",function(a){b.UA(a)});a.addEventListener("dblclick",function(){var b=a.ja();b===hf?a.Qc(1):a.Qc(b+1);a.dispatchEvent(new P("ondblclickzoomend"))});a.dl=a.gh();setInterval(function(){if(a.Wb()){var c=a.gh();if(!c.Sb(a.dl)){a.dl=c;var e=new P("onsize_changed");e.g5=a.dl;e.size=c;a.dispatchEvent(e);c=b.cf;b.yu();c!=b.cf&& b.Bd.ap&&b.Bd.ap();b.za(a.Ja(),b.cf,b.$g)}}},80);Oa()&&a.addEventListener("refresh",function(){b.Bd.tr()})},UA:function(){var a=this.cf;this.yu();a!=this.cf&&this.Bd.ap&&this.Bd.ap();this.Bd.Kk&&this.Bd.Kk();this.ld.Kk&&this.ld.Kk();a=this.W;this.za(a.Ja(),this.cf,this.$g);"cssRender"===a.Fq()&&a.rd(a.Ja())},EI:function(a){a&&("number"===typeof a.heading&&this.W.cr===t)&&(this.W.Ka.heading=a.heading,this.W.Ka.pitch=a.pitch);var b=this.W.qX(a&&a.id,["pov"]);b&&b.pov&&(this.W.Ka.heading=b.pov.heading, this.W.Ka.pitch=b.pov.pitch);if(this.W.XG&&a.indoorPois){for(var b=q,c=this.W.dR,e=0,f=a.indoorPois.length;e<f;e++)c==a.indoorPois[e].panoIId&&(b=a.indoorPois[e]);b&&(this.W.Ka.heading=of(b.pointX-a.ph,b.pointY-a.qh),this.W.Ka.pitch=0);this.W.XG=t;this.W.t1=q}this.W.cr&&(this.W.cr=t);this.W.Es();a&&a.Vl?(this.W.JN(4),this.W.ON(5),this.W.hy("inter")):(this.W.JN(3),this.W.ON(4),this.W.hy("street"));this.Bd.setData(a,this.wD(),this.cf);this.ld.setData(a)},LT:function(a,b,c,e){var f=this;this.Bd.Qc(f.wD(), f.cf,{hp:e,LZ:function(a){f.US.gr(a)}});"cvsRender"!=this.W.$j&&this.Bd.za(a,b,c);this.ld.za(a,b,c)},za:function(a,b,c){this.Bd.za(a,b,c);this.ld.za(a,b,c)},u3:x("cf"),wD:function(){return this.W.ja()},m3:x("$g"),yu:function(){var a=bk(this.W.gh(),this.W.ja());this.$g=a.hK;this.cf=a.JL}});function nk(a){this.W=a}D.Gk(function(a){var b=new nk(a);a.addEventListener("dataload",function(a){b.ha=a.data;b.Mi()});a.addEventListener("zoom_changed_inner",function(){b.rb&&(b.rb.stop(),b.rb=q)})}); nk.prototype.Mi=function(){function a(a,b){G.mg.Bd.Tg||(i=p,M.rb&&M.rb.stop(),k=a,m=b,C=G.Ja().heading,E=G.Ja().pitch,G.dispatchEvent(new P("ontouchstart")))}function b(a,b){if(i&&(!G.md||!I()))z=p,M.hA||(M.hA=p,M.r1=eb()),f(a,b),s=n-a,v=o-b,n=a,o=b,M.MH=eb()}function c(a){i&&(i=t,!z&&(!B&&S)&&M.MG&&(M.MG=t,M.Bn?(M.Ji&&(clearTimeout(M.Ji),M.Ji=q),10>k-M.Bn.x&&10>m-M.Bn.y&&G.dispatchEvent(new P("ondblclick")),M.Bn=q):(M.Bn={x:k,y:m},M.Ji=setTimeout(function(){var a,b,c=G.oA;a=G.Yd;var e=0;for(b=0;a.offsetParent;)e+= a.offsetLeft,b+=a.offsetTop,a=a.offsetParent;a=k-e;b=m-b;Oa()&&(a*=2,b*=2);0===c.wL(a,b)&&G.dispatchEvent(new P("onclick"));M.Bn=q},400))),M.hA=t,e(a),B=z=t)}function e(a){if(a){var b=eb()-M.MH;if(!(100<b||10<b&&10>Math.abs(s)&&10>Math.abs(v))){var c;I()?(b=a.changedTouches[0].clientX,c=a.changedTouches[0].clientY):(b=a.clientX,c=a.clientY);a=new R(k,m);c=new R(b,c);var b=[0<c.x-a.x?1:-1,0<c.y-a.y?1:-1],e=Math.abs(a.x-c.x),g=0,i=0;0==Math.abs(a.y-c.y)?g=e:(a=Math.abs(a.x-c.x)/Math.abs(a.y-c.y),i= Math.round(Math.sqrt(24336/(1+a*a))),g=Math.round(a*i));-1==b[0]&&(g=-g);-1==b[1]&&(i=-i);M.rb&&M.rb.stop();C=G.Ja().heading;E=G.Ja().pitch;M.rb=new wb({duration:625,Ic:60,ac:function(a){return a*0.3125-0.15625*a*a},za:function(a){a=a*6.4;f(a*g,a*i)},finish:function(){M.rb=q},it:function(){M.rb=q}})}}}function f(a,b){w=-a*M.ru;y=b*M.ru;var c=C+w,e=E+y;e>G.Sj&&(e=G.Sj);e<G.Uj&&(e=G.Uj);G.rd({heading:c,pitch:e})}function g(a){if(G.m.enableScrollWheelZoom){var a=window.event||a,b=new P("onmousewheel"); b.Jp=0<=a.wheelDelta||0>a.detail;var c=new Date;if(!(220>c-ca)&&(ca=c,"path"!=(a.srcElement||a.target).tagName)){var c=la(b,a),e=a.srcElement||a.target,f=a.offsetX||a.layerX||0,g=a.offsetY||a.layerY||0;1!=e.nodeType&&(e=e.parentNode);for(;e&&e!=G.Ra();){e.ca&&(A.lang.Nc(e.ca)instanceof ib&&(overlay=A.lang.Nc(e.ca)),A.lang.Nc(e.ca)instanceof bd&&(infoWindow=A.lang.Nc(e.ca)));if(!(0==e.clientWidth&&0==e.clientHeight&&e.offsetParent&&"TD"==e.offsetParent.nodeName)&&"http://www.w3.org/2000/svg"!=e.namespaceURI)f+= e.offsetLeft||0,g+=e.offsetTop||0;else if("http://www.w3.org/2000/svg"==e.namespaceURI){var i=G.mg.ld&&G.mg.ld.ff||q;if(-1<navigator.userAgent.indexOf("Opera")&&"svg"!=e.tagName){if(e=A.lang.Nc(e.ca))e=e.te(),f+=M.yc(e.Ve()).x,g+=M.yc(e.Qf()).y;break}if(i&&(!A.fa.na||9<=A.fa.na&&"svg"==e.nodeName.toLowerCase()))f+=parseInt(i.style.left),g+=parseInt(i.style.top)}e=e.offsetParent}c.x=f;c.y=g;G.ja();G.Ja();G.Ja();var k;if(b.Jp==p){if(G.ja()==hf){Fb(a);return}k=G.ja()+2/3}else if(b.Jp==t){if(G.ja()== jf){Fb(a);return}k=G.ja()-2/3}G.Qc(k)}Fb(a)}}if(!this.lS){this.lS=p;var i=t,k,m,n=0,o=0,s,v,w=0,y=0,z=t,B=t,C,E,F,G=this.W,K=t,O=0;this.ru=ok(this);this.MH=0;this.hA=t;this.Bn=q;this.yI=1;var M=this,S=t;I()?(A.V(G.Yd,"touchstart",function(b){S=p;for(var c=b.target;c&&c!=G.Yd;){if(c===G.zl){S=t;break}c=c.offsetParent}M.MG=p;var c=b.touches[0].clientX,e=b.touches[0].clientY,f=G.oA;if(Oa())f&&f.Iz(b.touches[0].pageX*f.Hc,b.touches[0].pageY*f.Hc)!=q&&(S=t);else if(!Pb()&&f){var g=Eb(G.Yd);-1!=f.ZK(c- g.left,e-g.top)&&(S=t)}a(c,e);(!A.platform.pj||-1==navigator.userAgent.indexOf("QQBrowser"))&&b.preventDefault();b.stopPropagation()}),A.V(G.Yd,"touchmove",function(a){var c=a.touches[0],e=c.clientX-k,c=c.clientY-m;if(!K&&(3<Math.abs(e)||3<Math.abs(c)))b(e,c),e=new P("ontouchmove"),e.S5=new R(a.touches[0].pageX,a.touches[0].pageY),G.dispatchEvent(e);a.preventDefault();a.stopPropagation()}),A.V(document,"touchend",function(a){c(a);S=t}),G.Yd.addEventListener("gesturestart",function(){O=G.ja()},t), G.Yd.addEventListener("gesturechange",function(a){M.yI=a.scale;B=K=p;a=M.yI*O;4<a?a=4:1>a&&(a=1);a=Math.round(100*a)/100;G.Qc(a,{hp:p})},t),G.Yd.addEventListener("gestureend",function(){K=t;G.ja()!=O&&G.dispatchEvent(new P("onpinchtozoomend"))},t)):(A.V(G.Yd,"mousedown",function(b){a(b.clientX||b.pageX||0,b.clientY||b.pageY||0);F=b.target||b.srcElement;A.fa.na&&F.setCapture&&F.setCapture();M.iT=G.Yd.style.cursor;G.Yd.style.cursor=H.Gd;A.fa.na||Fb(b)}),A.V(G.Yd,"mousemove",function(a){b((a.clientX|| a.pageX||0)-k,(a.clientY||a.pageY||0)-m);na(a)}),A.V(document,"mouseup",function(a){ma(a);c(a);A.fa.na&&(F&&F.releaseCapture)&&F.releaseCapture();G.Yd.style.cursor=M.iT||H.wc}));G.addEventListener("zoom_changed_inner",function(){M.ru=ok(M)});G.addEventListener("size_changed",function(){M.ru=ok(M)});var ca=new Date;A.V(G.Ra(),"mousewheel",g);window.addEventListener&&G.Ra().addEventListener("DOMMouseScroll",g,t)}}; function ok(a){if(!a.ha)return q;var b=a.W,c=bk(b.gh(),b.ja()),e=c.JL,c=c.hK;if("cssRender"===b.Fq()&&!Oa())return 360/(a.ha.tiles.Uo(e)*c);b=a.W.ja();return 180/Math.pow(2,b)/a.W.gh().height};function mk(a,b){A.lang.Ha.call(this);this.W=a;this.Fa=b;this.Jh=[];this.Lh={};this.HA=t;this.Xy()}A.lang.xa(mk,A.lang.Ha,"PanoramaOverlayMgr"); A.extend(mk.prototype,{Xy:function(){var a=this,b=this.W;b.addEventListener("add_overlay",function(c){c=c.overlay;c.ya(b);a.Jh.push(c);a.ir()});b.addEventListener("dataload",function(){a.HA=p;a.ir()});b.addEventListener("remove_overlay",function(b){for(var b=b.overlay,e=0,f=a.Jh.length;e<f;e++)b==a.Jh[e]&&a.Jh.splice(e,1);b.remove();a.ir()});b.addEventListener("clear",function(){a.HA=t});b.addEventListener("zoom_changed",function(){a.gr()});b.addEventListener("dataload",function(){a.ir()});b.addEventListener("pov_changed", function(){a.gr()});b.addEventListener("size_changed",function(){a.gr()});b.addEventListener("onoverlay_property_changed",function(){a.ir()})},ir:function(){this.pT();if(0!=this.Jh.length&&this.HA){for(var a,b,c,e=this.Jh.length-1;0<=e;e--)if(b=this.Jh[e],ovarlayDom=b.Yc(),c=b.Ja())a=c.heading,b.xO(),b=b.jd,this.Lh[a]||(this.Lh[a]={}),this.Lh[a][b]={dom:ovarlayDom,pov:c},this.W.zl.appendChild(ovarlayDom);this.gr()}},gr:function(a){this.W.Ja();var a=a||this.Fa.cf,b=this.Fa.$g,c=function(){function a(c){c.top= Math.floor(c.top);var e=b[c.top];if(!e)return t;for(var f=e.length-1;0<=f;f--)if(c.left>=e[f].left&&c.left<=e[f].right||c.right>=e[f].left&&c.right<=e[f].right)return p;return t}var b={};return function(c){for(c.top=Math.floor(c.top);a(c);)c.top+=-36;b[c.top]?b[c.top].push(c):b[c.top]=[c];return c}}(),e;for(e in this.Lh)for(var f in this.Lh[e]){var g=this.Lh[e][f],i=this.$S(e,g.pov.pitch,a,b),g=g.dom,i=c({top:i[1],left:i[0],right:i[0]+g.offsetWidth});g.style.left=i.left-g.offsetWidth/2+"px";g.style.top= i.top+g.offsetHeight/2+"px"}},$S:function(a,b,c,e){if(Oa())return this.aT(a,b);var f=this.W;for(svHeading=f.Ja().heading%360;0>svHeading;)svHeading=(svHeading+360)%360;var g=(a-svHeading)%360,a=f.gh(),c=360/(2*Math.pow(2,c-2)*e);180<g?g-=360:-180>g&&(g+=360);e=Math.round(a.width/2+g/c);b=Math.round(a.height/2-(b-f.Ja().pitch)/c);return[e,b]},aT:function(a,b){var c=500*Math.cos(U(b)),c=Math.round(100*c)/100;"string"==typeof a&&(a=parseFloat(a));var e;e=a+this.W.ha.tiles.dirNorth;e%=360;var f=this.W.mg.Bd; e=pk.ug(Math.cos(U(e))*c,500*Math.sin(U(b)),Math.sin(U(e))*c,1);var c=pk.create(),g=f.Kh;qk.multiply(c,f.Hf[0],e);qk.multiply(c,g,c);if(0>c[3])return[-1E3,-1E3];f=this.W.dl;return[(c[0]/c[3]+1)/2*f.width,(1-c[1]/c[3])/2*f.height]},pT:function(){for(var a in this.Lh)for(var b in this.Lh[a]){var c=this.Lh[a][b].dom;c.parentNode.removeChild(c)}this.Lh={}}});A.extend(nf.prototype,{ya:function(a){this.W=a;this.la()||this.va(this.W.la());this.oz();this.Vy()},Yc:x("ed"),hide:function(){this.Ua=t;this.ed&&(this.ed.style.display="none")},show:function(){this.Ua=p;this.ed&&(this.ed.style.display="block")},isVisible:x("Ua"),xO:function(){var a=this.Dn();100<a?(a/=1E3,a=100>a?a.toFixed(2):a.toFixed(0),a+="\\u516c\\u91cc"):(a=100>a?a.toFixed(2):a.toFixed(0),a+="\\u7c73");this.tq.innerHTML=a},oz:function(){var a=this.tk(),b=L("div"),c=b.style;c.position="absolute"; c.backgroundColor="rgba(29, 29, 29, 0.8)";c.padding="7px 0";c.height="19px";c.font="16px arial";c.color="white";c.whiteSpace="nowrap";c.borderRadius="4px";c.left="-1000px";c.top="-1000px";c=L("div");c.style["float"]="left";c.style.lineHeight="19px";b.appendChild(c);var e=L("span");e.style.margin="0 14px";e.innerHTML=a;c.appendChild(e);a=L("span");a.style.color="color:rgba(255,255,255,0.3)";a.innerHTML="|";c.appendChild(a);var f=L("span");f.style.margin="0 8px";f.style.color="#60c7fa";f.style.fontSize= "12px";f.innerHTML="0\\u7c73";c.appendChild(f);this.MQ===t&&(f.style.display="none",a.style.display="none");this.ed=b;this.tq=f;this.Br=e},Vy:function(){var a=this;this.pQ(this.ed,function(b){a.dispatchEvent(new P("onclick"),{type:"click",target:a});Fb(b)});A.V(this.ed,"mouseenter",function(){a.dispatchEvent(new P("onmouseover"),{type:"mouseover",target:a})});A.V(this.ed,"mouseleave",function(){a.dispatchEvent(new P("onmouseout"),{type:"mouseout",target:a})})},pQ:function(a,b){if(I()){var c=0,e=0, f=0;a.addEventListener("touchstart",function(a){c=(new Date).getTime();e=a.touches[0].pageX;f=a.touches[0].pageY},t);a.addEventListener("touchend",function(a){200<=(new Date).getTime()-c||(5<=Math.abs(a.changedTouches[0].pageX-e)||5<=Math.abs(a.changedTouches[0].pageY-f))||b.call(this,a)},t)}else A.V(this.ed,"click",b)},Lf:function(a,b){this.ed&&("content"===a&&(this.Br.innerHTML=b),this.W.dispatchEvent(new P("onoverlay_property_changed")))},remove:function(){this.ed=this.tq=this.Br=q;this.dispatchEvent(new P("onremove"), {type:"remove",target:this})}});A.extend(qf.prototype,{ya:function(a){this.W=a;this.oz();(a=this.uD())&&(a.panoId||a.panoIId)&&this.Vy(a)},Yc:x("ed"),hide:function(){this.Ua=t;this.ed.style.display="none"},show:function(){this.Ua=p;this.ed.style.display="block"},isVisible:x("Ua"),xO:function(){var a=this.W.la(),b=this.la(),a=T.uk(a,b);100<a?(a/=1E3,a=100>a?a.toFixed(2):a.toFixed(0),a+="\\u516c\\u91cc"):(a=100>a?a.toFixed(2):a.toFixed(0),a+="\\u7c73");this.tq.innerHTML=a},Vy:function(a){var b=this;if(a.panoIId){var c=function(c){b.W.VE(a.panoIId); c.stopPropagation();c.preventDefault()};I()?A.V(this.Gq,"touchend",function(a){c(a)}):(this.Gq.style.cursor="pointer",A.V(this.Gq,"click",function(a){c(a)}))}if(a.panoId){var e=function(c){function e(){b.W.rd(b.Ja());b.W.removeEventListener("dataload",e)}var i=a.panoId;b.W.Wb()!=i&&(b.W.Cc(i),b.W.addEventListener("dataload",e));c.stopPropagation();c.preventDefault()};A.V(this.ed,"touchend",function(a){e(a)});this.ed.style.cursor="pointer";A.V(this.ed,"click",function(a){e(a)})}},oz:function(){var a= this.To(),b=L("div"),c=b.style;c.position="absolute";c.backgroundColor="rgba(29, 29, 29, 0.8)";c.padding="7px 0";c.height="19px";c.font="16px arial";c.color="white";c.whiteSpace="nowrap";c.borderRadius="4px";c.left="-1000px";c.top="-1000px";var e=L("img");e.src=this.Oo();e.style.width="24px";e.style.height="24px";e.style.position="absolute";e.style.left="5px";e.style.top="5px";c.paddingLeft="40px";b.appendChild(e);c=L("div");c.style["float"]="left";c.style.lineHeight="19px";b.appendChild(c);var f= L("span");f.style.margin="0 14px";f.innerHTML=a;c.appendChild(f);a=L("span");a.style.color="color:rgba(255,255,255,0.3)";a.innerHTML="|";c.appendChild(a);a=L("span");a.style.margin="0 8px";a.style.color="#60c7fa";a.style.fontSize="12px";a.innerHTML="0\\u7c73";c.appendChild(a);this.ed=b;this.Gq=e;this.tq=a;this.Br=f},Lf:function(a,b){switch(a){case "title":this.Br.innerHTML=b;break;case "altitude":this.W.dispatchEvent(new P("onoverlay_position_changed"));break;case "position":this.W.dispatchEvent(new P("onoverlay_position_changed"))}}, remove:function(){this.Br=this.tq=this.Gq=this.ed=q;this.dispatchEvent(new P("onremove"),{type:"remove",target:this})}});function rk(a){this.Mi(a)}Wa()&&D.Gk(function(a){new rk(a)}); A.extend(rk.prototype,{Mi:function(a){this.W=a;this.ho=this.fo=p;this.Fa();this.ga()},Fa:function(){this.R=L("div");var a=this.R.style;a.position="absolute";a.left="10px";a.top="10px";a.zIndex=1201;a=this.R;a.innerHTML=this.Aq();Wa()?(this.kd=A.ea(a.children[2]),this.On=[A.ea(this.kd.children[0]),A.ea(this.kd.children[1]),A.ea(this.kd.children[2]),A.ea(this.kd.children[3])],Pb()?this.SI=A.ea(a.children[1].childNodes[0]):Ob()&&(this.dJ=A.ea(a.children[1].childNodes[0])),this.ae=A.ea(a.children[3])): I()&&(this.ae=A.ea(a.children[0]));this.yh=A.ea(this.ae.children[0]);this.cg=A.ea(this.ae.children[1]);A.fa.na&&(this.kd.style.background=\'url("\'+H.sa+\'blank.gif") repeat\');6==A.fa.na&&this.zT();I()&&(this.ae.style.left=this.ae.style.top="0",this.ae.style.width="36px",this.ae.style.height="78px",this.yh.style.width=this.cg.style.width="33px",this.yh.style.height=this.cg.style.height="36px",this.cg.style.top="37.5px");this.W.ja()==hf&&this.Vn("zoomIn",t);this.W.ja()==jf&&this.Vn("zoomOut",t);this.W.Ra().appendChild(a)}, Aq:function(){var a=[];Wa()&&(a.push(this.Dz()),a.push(this.pR()),a.push(this.rR()));a.push(this.Ez());return a.join("")},pR:function(){if(Pb())return\'<svg version="1.1" overflow="hidden" width="82px" height="82px" viewBox="0 0 82 82" style="position: absolute; top: 0px; left: 0px;"><g transform="rotate(0, 41, 41)"><rect x="33" y="1" width="14" height="12" rx="4" ry="4" stroke="#868685" stroke-width="1" fill="#f8f8f8"></rect><polyline points="37.5,9.5 37.5,3.5 42.5,9.5 42.5,3.5" stroke-linejoin="bevel" stroke-width="1.5" fill="#f2f4f6" stroke="#868685"></polyline></g></svg>\'; if(Ob())return\'<div style="position:absolute;top:0;left:0;z-index:0"><v:group style="position:absolute;width:82px;height:82px; behavior:url(#default#VML);rotation:0" unselectable="on" coordsize="82,82" coordorigin="-41,-41"><v:roundrect style="width:14px;height:12px;top:-40px; behavior:url(#default#VML);left:-7px;z-index:2" fillcolor="#f8f8f8" arcsize ="19661f" coordsize="21600,21600" strokecolor="#868685" strokeweight="1pt"></v:roundrect><v:polyline style="behavior: url(#default#VML);z-index:3" fillcolor="#f2f4f6" points="-3,-31,-3,-37,3,-31,3,-37" strokeweight="1.2pt"><v:stroke style="behavior:url(#default#VML)" color="#868685" joinstyle="bevel"></v:stroke></v:polyline></v:group></div>\'}, Dz:function(){return\'<div style="position:absolute;top:4px;left:4px;width:74px;height:74px;background:url(\'+H.sa+\'st-navictrl.png) no-repeat;-webkit-user-select:none;overflow:hidden"><div></div></div>\'},rR:function(){return\'<div style="position:absolute;top:0px;left:0;width:82px;height:82px;-webkit-user-select:none;cursor:\'+H.wc+\'"><div style="position:absolute;left:32px;top:13px;cursor:pointer;width:17px;height:17px;" title="\\u5411\\u4e0a\\u5e73\\u79fb"></div><div style="position:absolute;left:14px;top:32px;cursor:pointer;width:17px;height:17px;" title="\\u5411\\u5de6\\u5e73\\u79fb"></div><div style="position:absolute;left:51px;top:32px;cursor:pointer;width:17px;height:17px;" title="\\u5411\\u53f3\\u5e73\\u79fb"></div><div style="position:absolute;left:33px;top:51px;cursor:pointer;width:17px;height:17px;" title="\\u5411\\u4e0b\\u5e73\\u79fb"></div></div>\'}, Ez:function(){var a="background-image:url(\'"+H.sa+"st-navictrl.png\');background-repeat:no-repeat;background-position:-74px 0;";I()&&(a="background-image:url(\'"+H.sa+"st-navictrl-hd.png\');background-repeat:no-repeat;background-position:0 0;background-size:180px 78px;");return\'<div style="position:absolute;top:84px;left:30px;width:24px;height:52px;\'+a+\'-webkit-user-select:none;overflow:hidden"><div style="position:absolute;cursor:pointer;width:22px;height:24px;top:0;left:0;-webkit-user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)" title="\\u653e\\u5927\\u4e00\\u7ea7"></div><div style="position:absolute;cursor:pointer;width:22px;height:24px;top:25px;left:0;-webkit-user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)" title="\\u7f29\\u5c0f\\u4e00\\u7ea7"></div><div></div></div>\'}, ga:function(){var a=this.W,b=this;if(Wa()){A.V(this.On[0],"click",function(){var b=a.Ja();a.gy({heading:b.heading,pitch:b.pitch+30})});A.V(this.On[1],"click",function(){var b=a.Ja();a.gy({heading:b.heading-45,pitch:b.pitch})});A.V(this.On[2],"click",function(){var b=a.Ja();a.gy({heading:b.heading+45,pitch:b.pitch})});A.V(this.On[3],"click",function(){var b=a.Ja();a.gy({heading:b.heading,pitch:b.pitch-30})});for(var c=0;c<this.On.length;c++)A.V(this.On[c],"mousedown",ma);b.gv=t;A.V(this.kd,"mousedown", function(c){b.gv=p;b.kd.style.cursor=H.Gd;A.fa.na&&b.kd.setCapture&&b.kd.setCapture();b.QI=b.EG(c);b.IQ=a.Ja().heading;A.fa.na||Fb(c)});A.V(document,"mousemove",function(c){b.gv&&a.rd({heading:b.IQ+360-(b.EG(c)-b.QI),pitch:a.Ja().pitch})});A.V(document,"mouseup",function(){b.gv&&(b.gv=t,b.kd.style.cursor=H.wc,A.fa.na&&b.kd.releaseCapture&&b.kd.releaseCapture(),b.QI=q)});a.addEventListener("position_changed",function(){var c=360-this.Ja().heading;Pb()?b.SI.setAttribute("transform","rotate("+c+", 41, 41)"): Ob()&&(b.dJ.style.rotation=c);a.removeEventListener("position_changed",arguments.callee)});a.addEventListener("pov_changed",function(){var a=360-this.Ja().heading;Pb()?b.SI.setAttribute("transform","rotate("+a+", 41, 41)"):Ob()&&(b.dJ.style.rotation=a)});a.addEventListener("navigation_visible_changed",function(){Wa()&&(a.m.navigationControl?b.show():b.$())});a.addEventListener("visible_changed",function(){a.ex()&&a.m.navigationControl?b.show():b.$()})}A.V(this.R,"mousemove",function(){a.dispatchEvent(new P("hide_ellipse"))}); A.V(this.R,"mouseout",function(){a.dispatchEvent(new P("show_ellipse"))});A.V(this.yh,"click",function(){a.Qc(a.ja()+1)});A.V(this.cg,"click",function(){a.Qc(a.ja()-1)});Wa()?(A.V(this.yh,"mousedown",function(){b.Zj(b.fo,-98)}),A.V(this.cg,"mousedown",function(){b.Zj(b.ho,-122)}),A.V(this.yh,"mouseup",function(){b.Zj(b.fo,-74)}),A.V(this.cg,"mouseup",function(){b.Zj(b.ho,-74)})):I()&&(A.V(this.yh,"touchstart",function(){b.Zj(b.fo,-98)}),A.V(this.cg,"touchstart",function(){b.Zj(b.ho,-122)}),A.V(this.yh, "touchend",function(){b.Zj(b.fo,-74)}),A.V(this.cg,"touchend",function(){b.Zj(b.ho,-74)}));this.W.addEventListener("zoom_changed_inner",function(){if(this.ja()==hf)b.Vn("zoomIn",t);else if(this.ja()==jf)b.Vn("zoomOut",t);else{b.Vn("zoomIn",p);b.Vn("zoomOut",p)}})},Zj:function(a,b){a&&(6==A.fa.na?this.ae.children[2].style.left=b+"px":(I()&&(b=36*((b+74)/24)),this.ae.style.backgroundPosition=b+"px 0"))},zT:function(){var a=this.R.children[0];a.style.background="";a.children[0].style.cssText+="position:absolute;left:0;top:0;width:98px;height:74px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\'"+ H.sa+"st-navictrl.png\')";this.ae.style.background="";this.ae.children[2].style.cssText+="position:absolute;z-index:-1;left:-74px;top:0;width:98px;height:74px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\'"+H.sa+"st-navictrl.png\')"},show:function(){this.R.style.display=""},$:function(){this.R.style.display="none"},EG:function(a){var a=window.event||a,b=a.pageX||a.clientX,a=a.pageY||a.clientY,c=Eb(this.W.Ra()),b=b-c.left-50,a=-(a-c.top-50),b=180*(Math.atan2(a,b)/Math.PI);return 90> b?90-b:450-b},Vn:function(a,b){var c=this.ae.children[2];if("zoomIn"==a)if(b)if(this.fo=p,this.yh.style.cursor="pointer",6==A.fa.na)c.style.left="-74px";else{var e=-74;I()&&(e=0);this.ae.style.backgroundPosition=e+"px 0"}else this.fo=t,this.yh.style.cursor="",6==A.fa.na?c.style.left="-170px":(e=-170,I()&&(e=-144),this.ae.style.backgroundPosition=e+"px 0");"zoomOut"==a&&(b?(this.ho=p,this.cg.style.cursor="pointer",6==A.fa.na?c.style.left="-74px":(e=-74,I()&&(e=0),this.ae.style.backgroundPosition=e+ "px 0")):(this.ho=t,this.cg.style.cursor="",6==A.fa.na?c.style.left="-146px":(e=-146,I()&&(e=-108),this.ae.style.backgroundPosition=e+"px 0")))}});function sk(a,b){this.eB=a;this.af=[];this.cb={vo:q};var b=b||{},c;for(c in b)this.cb[c]=b[c]}sk.prototype.setData=function(a,b){if(0!==this.eB){if(this.af.length>this.eB){for(var c=Math.round(0.6*this.eB),e=0;e<c;e++){var f=this.af[e].LH;this.cb.vo&&this.cb.vo(this.af[f]);delete this.af[f]}this.af.splice(0,c)}this.af[a]||this.af.push(b);this.af[a]=b;b.LH=a}};sk.prototype.getData=function(a){return this.af[a]}; sk.prototype.clear=function(){for(var a=0;a<this.af.length;a++){var b=this.af[a].LH;this.cb.vo&&this.cb.vo(this.af[b]);delete this.af[b]}this.af=[]};function tk(){this.lz=0;this.Pg={}}tk.prototype.Tw=function(){var a=q,b;for(b in this.Pg)if(this.Pg[b]&&this.Pg[b].Cz===p)return this.Pg[b].Cz=t,this.Pg[b];a=new Image;this.lz++;b="img_"+this.lz;return this.Pg[b]=a};tk.prototype.clear=function(){for(var a in this.Pg)this.Pg[a]&&(this.Pg[a].onload=this.Pg[a].onerror=q);this.Pg={};this.lz=0};function kk(a){this.W=a;return"cvsRender"==a.$j?new uk(a):new vk(a)};function uk(a){this.W=a;this.Ph=a.Ph;this.Hj();this.W.ua=this;this.ga()} A.extend(uk.prototype,{ga:function(){var a=this,b=a.W;b.addEventListener("size_changed",function(c){a.Be(b.mg.cf,b.mg.wD(),c.size)})},setData:function(a,b,c){a&&(this.ha=a,this.uS(b,c))},Hj:function(){var a=L("canvas");a.width=this.W.Ra().clientWidth;a.height=this.W.Ra().clientHeight;var b=a.style;b.position="absolute";b.left=b.top="0";this.Ph.appendChild(a);this.bV=a.getContext("2d");this.ri=[];this.yJ=[];this.Vc=new wk(this.bV,this.ri,0,a.width,a.height,this.W);for(a=b=a=0;16>a;a++){this.ri[a]= [];for(b=0;8>b;b++){var c=new xk(this.W);c.pM=a;c.qM=b;c.canvas=this.Vc;this.ri[a][b]=c}}this.W.o2=this.Vc},za:function(a,b){if(a&&b){var c=a.heading%360,e=a.pitch;this.Pz({heading:c,pitch:e},b);this.Vc.Zh({heading:c,pitch:e},b)}},uS:function(a,b){this.Vc.KV();this.sR(this.ha);this.Vc.UX(this.ha);this.vI(a,b);this.Nz(b,p)},Qc:function(a,b){var c=this,e=p;b==this.Vc.ua.zoom&&(e=t);this.vI(a,b);e&&this.Nz(b,p);setTimeout(function(){c.Pz()},1E3)},sR:function(a){var b=this,c=a.tiles,e={we:[]};e.we[0]= new Image;e.we[0].src=c.getTilesUrl(a.id,{x:0,y:0},2);e.we[1]=new Image;e.we[1].src=c.getTilesUrl(a.id,{x:1,y:0},2);b.HO=0;e.we[0].onload=function(){b.Bx()};e.we[1].onload=function(){b.Bx()};this.yJ[0]=e},Bx:function(){this.HO++;2==this.HO&&(this.Vc.w_(this.yJ[0].we),this.Vc.Bx())},Pz:function(a,b){if(this.ha&&this.ha.tiles)for(var c=this.ha.tiles,e=[],b=b||this.Vc.ua.zoom,e=this.ri,f=this.Vc.eD(a),g=f.Zt,i=f.ds,k=f.Ys,f=f.vt,f=f>k?f-k:64+f-k,m=0,n=0,o=0;o<f+Math.pow(2,7-b);){for(var s=g;s<i+Math.pow(2, 7-b);){m=o+k;63<m?m%=64:0>m&&(m+=64);m=Math.floor(m*Math.pow(2,b-7));n=Math.floor(s*Math.pow(2,b-7));if(m<Math.pow(2,b-1)&&n<Math.pow(2,b-2)&&0==e[m][n].em){var v=c.getTilesUrl(this.ha.id,{x:m,y:n},b);e[m][n].RN(v)}s+=Math.pow(2,7-b)}o+=Math.pow(2,7-b)}},Nz:function(a,b){var c=t;b&&(c=p);if(!c)if(this.Cy)this.Cy=t;else return;if(this.ha&&this.ha.tiles){for(var c=this.ha.tiles,e=[],f=Math.pow(2,a-1),g=Math.pow(2,a-2),e=this.ri,i=0;i<f;i++)for(var k=0;k<g;k++)e[i][k].PZ();for(var i=this.Vc.eD(),f=i.Zt, g=i.ds,m=i.Ys,i=i.vt,n=i>m?i-m:64+i-m,o=0,s=0,i=0;i<n+Math.pow(2,7-a);){for(k=f;k<g+Math.pow(2,7-a);){o=i+m;63<o?o%=64:0>o&&(o+=64);o=Math.floor(o*Math.pow(2,a-7));s=Math.floor(k*Math.pow(2,a-7));if(o<Math.pow(2,a-1)&&s<Math.pow(2,a-2)){var v=c.getTilesUrl(this.ha.id,{x:o,y:s},a);e[o][s].RN(v)}k+=Math.pow(2,7-a)}i+=Math.pow(2,7-a)}}},Be:function(a,b,c){a!=this.Vc.ua.zoom&&(this.Cy=p);this.Vc.Kk(a,b,c);this.Nz(a);this.Pz();this.Vc.refresh()},vI:function(a,b){var c=t;b==this.Vc.ua.zoom?this.Cy=t:(this.Cy= p,b<this.Vc.ua.zoom&&(c=p));this.Vc.QZ(a,b);return c},vX:function(a){return this.Vc.xX(a)},hD:function(a,b){return this.Vc.hD(a,b)},H3:function(){return this.Vc.ua.Ga}}); function xk(a){this.we=new Image;this.src="";this.canvas=q;this.qM=this.pM=this.em=0;this.W=a;var b=this;this.IL=function(){-1!=b.src.indexOf("pos=0_0&z=1")&&b.W.dispatchEvent(new P("onthumbnail_complete"));b.em=2;b.canvas.eW(b.pM,b.qM)};this.we.onload=this.IL;this.RN=function(a){this.src==a?0==this.em&&b.IL():(this.src=this.we.src=a,this.em=1)};this.PZ=function(){this.src=this.we.src="";this.em=0}} function wk(a,b,c,e,f,g){this.heading=this.pitch=0;this.zoom=2;this.ri=b;this.Jk=[];this.rg=a;this.Rl=t;this.ua={a:e,jb:f,Pf:0,Jr:0,Ga:0,b1:512,heading:0,pitch:0,dd:32,zoom:0,rp:0,po:0,Kp:0,h2:0,Cm:0,i2:0,Hp:0,mt:0};this.W=g;this.Ms=t;this.AP()} A.extend(wk.prototype,{AP:function(){if(A.fa.mw){var a=navigator.userAgent.substr(navigator.userAgent.indexOf("Chrome"),12);27<Number(/[1-9][0-9]*/.exec(a+"1")[0])?(this.ua.po=0.0078125,this.ua.mt=2):(this.ua.po=0.015625,this.ua.mt=4);this.ua.Cm=0;this.ua.Hp=0}else A.fa.na?(this.ua.po=0.0078125,this.ua.Cm=0,this.ua.Hp=6):(this.ua.po=0.0078125,this.ua.Cm=0,this.ua.Hp=4),this.ua.mt=2},w_:ba("Jk"),Qw:function(){var a=this.ua,b=Math.PI/Math.pow(2,this.ua.rp);b>Math.PI/2+0.1&&(b=2*Math.PI/3);return a.a/ 2/Math.tan(b/2)},Kk:function(a,b,c){var e=this.ua;e.a=c.width;e.jb=c.height;this.rg.canvas.width=c.width;this.rg.canvas.height=c.height;e.zoom=a;e.rp=b;e.Ga=this.Qw();e.dd=16*Math.pow(2,a-2);e.nt=Math.pow(2,a-1);e.Fm=Math.pow(2,a-2);e.lp=Math.pow(2,7-a)},QZ:function(a,b){var c=this.ua;if(0==this.ua.Ga)c.zoom=b,c.rp=a,c.Ga=this.Qw(),c.dd=16*Math.pow(2,b-2),c.nt=Math.pow(2,b-1),c.Fm=Math.pow(2,b-2),c.lp=Math.pow(2,7-b),c.Kp=c.po*Math.pow(2,-a);else if(!(a==c.rp&&b==c.zoom)){this.Rl=p;var e=this.ua.Ga; c.dd=16*Math.pow(2,b-2);c.zoom=b;c.rp=a;c.nt=Math.pow(2,b-1);c.Fm=Math.pow(2,b-2);c.lp=Math.pow(2,7-b);e=(this.Qw()-e)/32;this.W.Bk();this.jJ(0,e);c.Kp=c.po*Math.pow(2,-a)}},UX:function(a){this.ua.heading-=this.ua.Pf/180*Math.PI;this.ua.Pf=a.tiles.dirNorth;this.ua.heading+=a.tiles.dirNorth/180*Math.PI;this.ua.Jr=a.tiles.pitch||0},jJ:function(a,b){var c=this;if(5>a)this.ua.Ga+=b*Math.pow(2,a),this.$Q(),setTimeout(function(){c.jJ(a+1,b)},0);else if(5==a){this.Rl=t;var e=this.ua.zoom;this.ua.Ga=this.Qw(); this.ua.dd=16*Math.pow(2,e-2);this.ua.nt=Math.pow(2,e-1);this.ua.Fm=Math.pow(2,e-2);this.ua.lp=Math.pow(2,7-e);this.W.ly();this.refresh()}},c5:function(a,b){this.Rl=p;var c=this.ua;this.tE={data:a,AU:b};this.tE.lc=0;var e=Math.cos((a.dir+c.Pf)/180*Math.PI),c=-Math.sin((a.dir+c.Pf)/180*Math.PI),c=e=0;this.W.Bk();this.WQ({index:1,C2:e,D2:c})},eW:function(a,b){if(!this.Rl&&this.Ms)if(1<this.ua.rp)this.refresh();else{var c=this.ua,e=c.dd,f=512/e,g=c.lp,i=Math.cos(c.pitch),k=Math.cos(c.heading),m=Math.sin(c.heading), n=c.Ga*Math.sin(c.pitch),o=c.Ga*i*m;c.Xp=-c.Ga*i*k;c.Yp=n;c.Zp=o;c.Nr=k;c.Kt=m;for(i=0;i<f;i++)for(k=0;k<f;k++){m={ub:{x:i*e,y:k*e-1},vb:{x:i*e-1,y:k*e+e+1},wb:{x:i*e+e+1,y:k*e+e}};n={ub:{x:i*e-1,y:k*e},vb:{x:i*e+e+1,y:k*e-1},wb:{x:i*e+e,y:k*e+e+1}};if(0==i)var s=-1;else i==g-1&&(s=1);if(0==k)var v=-1;else k==g-1&&(v=1);this.wC(m,a,b,c.zoom,s,v);this.xC(n,a,b,c.zoom,s,v)}}},WQ:function(){var a=this.ua;this.rg.clearRect(0,0,a.a,a.jb);a.heading-=a.Pf/180*Math.PI;a.Pf=this.tE.AU.h5;a.heading+=a.Pf/180* Math.PI;this.Jk=this.tE.data.we;this.Rl=t;this.W.ly();this.refresh()},fn:function(a,b,c,e,f){var c=this.ua,b=2*(0.5*a.x/512+b/2)*Math.PI,g=(0.5-a.y/512)*Math.PI,i=c.Ga,a=Math.cos(g),k=Math.sin(Math.abs(g));0.4>k?k=0.4:0.98<k&&(k=c.mt);var b=b+e*k,m=-a*Math.cos(b),k=Math.sin(g+f*k),n=a*Math.sin(b),f=c.Nr,e=c.Kt,b=c.Xp,a=c.Yp,g=c.Zp,o=b*m+k*a+n*g;0>o&&(o=t);o=i*i/o;i=o*m-b;m=o*k-a;n=o*n-g;o=Math.pow(i,2)+Math.pow(m,2)+Math.pow(n,2);k=Math.sqrt(o);0==o?e=f=0:(o=(i*e+n*f)/k,1<o?o=1:-1>o&&(o=-1),o=Math.acos(o), 0>i*f*a+m*e*g-m*f*b-n*a*e&&(o=2*Math.PI-o),f=k*Math.cos(o),e=k*Math.sin(o));return{x:c.a/2+f,y:c.jb/2-e}},pK:function(a,b,c,e,f,g){var i=this.rg,k=0,m=0,n=0,o=0,s=this.ua.Kp;e&&(1==e?m=s:-1==e&&(k=s));f&&(-1==f?n=s:1==f&&(o=s));e=this.ua.Cm;k=this.fn(a.ub,b,c,-e-k,n,g);if(!k)return t;n=this.fn(a.vb,b,c,e+m,e+n,g);if(!n)return t;c=this.fn(a.wb,b,c,m,-e-o,g);if(!c)return t;c={ub:k,vb:n,wb:c};g=c.ub;m=c.vb;o=c.wb;i.save();i.beginPath();i.moveTo(g.x,g.y);i.lineTo(m.x,m.y);i.lineTo(o.x,o.y);i.closePath(); i.clip();a=this.yk(a,c);i.transform(a[0],a[1],a[2],a[3],a[4],a[5]);i.drawImage(this.Jk[b],0,0);i.restore()},oK:function(a,b,c,e,f,g){var i=this.rg,k=0,m=0,n=0,o=0,s=this.ua.Kp;e&&(1==e?m=s:-1==e&&(k=s));f&&(-1==f?n=s:1==f&&(o=s));e=this.ua.Cm;n=this.fn(a.ub,b,c,-k,e+n,g);if(!n)return t;k=this.fn(a.vb,b,c,-e-k,-e-o,g);if(!k)return t;c=this.fn(a.wb,b,c,e+m,-o,g);if(!c)return t;c={ub:n,vb:k,wb:c};g=c.ub;m=c.vb;o=c.wb;i.save();i.beginPath();i.moveTo(g.x,g.y);i.lineTo(m.x,m.y);i.lineTo(o.x,o.y);i.closePath(); i.clip();a=this.yk(a,c);i.transform(a[0],a[1],a[2],a[3],a[4],a[5]);i.drawImage(this.Jk[b],0,0);i.restore()},KV:function(){this.Ms=t;this.W.Bk()},Bx:function(){this.Ms=p;this.refresh();this.W.ly()},Zh:function(a){if(this.Ms&&!this.Rl){var b=this.ua;b.pitch=a.pitch/180*Math.PI-b.Jr/180*Math.PI;b.heading=(a.heading+b.Pf)/180*Math.PI;b.heading>2*Math.PI?b.heading-=2*Math.PI:0>b.heading&&(b.heading+=2*Math.PI);a=b.dd;this.rg.clearRect(0,0,b.a,b.jb);var c=b.bound,e=c.Zt,f=c.ds,g=c.Ys,c=c.vt,c=c>g?c-g:64+ c-g,i=b.lp,k=b.Hp,m=Math.cos(b.pitch),n=Math.cos(b.heading),o=Math.sin(b.heading),s=b.Ga*Math.sin(b.pitch),v=b.Ga*m*o;b.Xp=-b.Ga*m*n;b.Yp=s;b.Zp=v;b.Nr=n;b.Kt=o;for(m=0;m<c;m++)for(n=e;n<f;n++){v=m+g;63<v?v%=64:0>v&&(v+=64);var o=Math.floor(v/i),s=Math.floor(n/i),v=v%i,w=n%i,y={ub:{x:v*a,y:w*a-k},vb:{x:v*a-k,y:w*a+a+k},wb:{x:v*a+a+k,y:w*a+a}},z={ub:{x:v*a-k,y:w*a},vb:{x:v*a+a+k,y:w*a-k},wb:{x:v*a+a,y:w*a+a+k}};if(0==v)var B=-1;else v==i-1&&(B=1);if(0==w)var C=-1;else w==i-1&&(C=1);this.wC(y,o,s,b.zoom, B,C);this.xC(z,o,s,b.zoom,B,C)}}},refresh:function(){if(this.Ms&&!this.Rl){var a=this.ua,b=a.dd;this.rg.clearRect(0,0,a.a,a.jb);var c=this.eD(),e=c.Zt,f=c.ds,g=c.Ys,c=c.vt,c=c>g?c-g:64+c-g,i=a.lp,k=Math.cos(a.pitch),m=Math.cos(a.heading),n=Math.sin(a.heading),o=a.Ga*Math.sin(a.pitch),s=a.Ga*k*n;a.Xp=-a.Ga*k*m;a.Yp=o;a.Zp=s;a.Nr=m;a.Kt=n;k=a.Hp;for(m=0;m<c;m++)for(n=e;n<f;n++){var v=m+g;63<v?v%=64:0>v&&(v+=64);var o=Math.floor(v/i),s=Math.floor(n/i),v=v%i,w=n%i,y={ub:{x:v*b,y:w*b-k},vb:{x:v*b-k,y:w* b+b+k},wb:{x:v*b+b+k,y:w*b+b}},z={ub:{x:v*b-k,y:w*b},vb:{x:v*b+b+k,y:w*b-k},wb:{x:v*b+b,y:w*b+b+k}};if(0==v)var B=-1;else v==i-1&&(B=1);if(0==w)var C=-1;else w==i-1&&(C=1);this.wC(y,o,s,a.zoom,B,C);this.xC(z,o,s,a.zoom,B,C)}}},$Q:function(){var a=this.ua;this.rg.clearRect(0,0,a.a,a.jb);var b=a.Hp,c=Math.cos(a.pitch),e=Math.cos(a.heading),f=Math.sin(a.heading),g=a.Ga*Math.sin(a.pitch),i=a.Ga*c*f;a.Xp=-a.Ga*c*e;a.Yp=g;a.Zp=i;a.Nr=e;a.Kt=f;for(a=0;16>a;a++)for(c=0;16>c;c++){e={ub:{x:32*a,y:32*c-b},vb:{x:32* a-b,y:32*c+32+b},wb:{x:32*a+32+b,y:32*c+32}};f={ub:{x:32*a-b,y:32*c},vb:{x:32*a+32+b,y:32*c-b},wb:{x:32*a+32,y:32*c+32+b}};if(0==a)var k=-1;else 15==a&&(k=1);if(0==c)var m=-1;else 15==c&&(m=1);this.oK(e,0,2,k,m);this.pK(f,0,2,k,m);this.oK(e,1,2,k,m);this.pK(f,1,2,k,m)}},hD:function(a,b){var c=this.ua,e=a-c.a/2,f=c.jb/2-b,g=c.pitch+c.Jr/180*Math.PI,i=c.heading-c.Pf/180*Math.PI,k=-c.Ga*Math.cos(g)*Math.cos(i),m=c.Ga*Math.sin(g),n=c.Ga*Math.cos(g)*Math.sin(i),o=e*Math.sin(i),e=e*Math.cos(i),s=f*Math.sin(g)* Math.cos(i),f=f*Math.cos(g),k=k+o+s,m=m+f,f=n+e+-f*Math.sin(g)*Math.sin(i),g=this.Ja(k,m,f);if(2<m)return t;i=2.08/(2.08-m);k*=i;f*=i;return{nG:k,oG:f,Ga:Math.sqrt(Math.pow(k,2)+Math.pow(f,2)),ME:c.Ga,heading:g.heading}},eD:function(a){var b=this.ua;a&&(b.heading=(a.heading+b.Pf)/180*Math.PI,b.heading>2*Math.PI?b.heading-=2*Math.PI:0>b.heading&&(b.heading+=2*Math.PI),b.pitch=a.pitch/180*Math.PI-b.Jr/180*Math.PI);var c=Math.cos(b.pitch),e=Math.sin(b.pitch),f=Math.cos(b.heading),g=Math.sin(b.heading), a=-b.Ga*c*f,i=b.Ga*e,k=b.Ga*c*g,m=b.jb/2*e*f,n=b.jb/2*c,o=-b.jb/2*e*g,s=-b.jb/2*e*f,c=-b.jb/2*c,e=b.jb/2*e*g,v=-b.a/2*g,w=-b.a/2*f,g=b.a/2*g,f=b.a/2*f;if(0<b.pitch)var y=this.Ja(a+m+v,i+n+0,k+o+w),z=this.Ja(a+s,i+c,k+e),B=this.Ja(a+s+g,i+c+0,k+e+f);else var C=a+m,E=i+n,o=k+o,F=this.Ja(C,E,o),E=this.Ja(C+v,E+0,o+w),C=this.Ja(a+s+g,i+c+0,k+e+f);a=Math.atan(b.jb/2/b.Ga);b.pitch+a>Math.PI/2?(F=0,z=z.pitch<B.pitch?z.pitch:B.pitch,z=Math.ceil(32*(Math.PI/2-z)/Math.PI)):b.pitch-a<-Math.PI/2?(z=F.pitch>E.pitch? F.pitch:E.pitch,F=Math.floor(32*(Math.PI/2-z)/Math.PI),z=32):0<b.pitch?(F=Math.floor(32*(Math.PI/2-b.pitch-a)/Math.PI),z=z.pitch>B.pitch?B.pitch:z.pitch,z=Math.ceil(32*(Math.PI/2-z)/Math.PI)):(z=F.pitch>E.pitch?F.pitch:E.pitch,F=Math.floor(32*(Math.PI/2-z)/Math.PI),z=Math.ceil(32*(Math.PI/2-b.pitch+a)/Math.PI));Math.abs(b.pitch)>=Math.PI/2-a?(C=0,y=64):0<b.pitch?(C=Math.floor(32*y.heading/Math.PI),y=b.heading>y.heading?Math.ceil(32*(2*b.heading-y.heading)/Math.PI):Math.ceil(32*(2*b.heading+2*Math.PI- y.heading)/Math.PI)):(y=Math.ceil(32*C.heading/Math.PI),C=b.heading>C.heading?Math.floor(32*(2*b.heading-2*Math.PI-C.heading)/Math.PI):Math.floor(32*(2*b.heading-C.heading)/Math.PI));0>C&&(C+=64);64<y&&(y-=64);32<z&&(z=32);0>F&&(F=0);b.bound={Zt:F,ds:z,Ys:C,vt:y};return{Zt:F,ds:z,Ys:C,vt:y}},wC:function(a,b,c,e,f,g){if(2==this.ri[b][c].em){var i=this.rg,k=0,m=0,n=0,o=0,s=this.ua.Kp;f&&(1==f?m=s:-1==f&&(k=s));g&&(-1==g?n=s:1==g&&(o=s));f=this.ua.Cm;n=this.lg(a.ub,b,c,e,0,-k,f,n);if(!n)return t;k=this.lg(a.vb, b,c,e,-f,-k,-f,-o);if(!k)return t;e=this.lg(a.wb,b,c,e,f,m,0,-o);if(!e)return t;e={ub:n,vb:k,wb:e};m=e.ub;o=e.vb;k=e.wb;i.save();i.beginPath();i.moveTo(m.x,m.y);i.lineTo(o.x,o.y);i.lineTo(k.x,k.y);i.closePath();i.clip();a=this.yk(a,e);i.transform(a[0],a[1],a[2],a[3],a[4],a[5]);i.drawImage(this.ri[b][c].we,0,0)}else{i=this.rg;o=n=m=k=0;s=0.0078125;f&&(1==f?m=s:-1==f&&(k=s));g&&(-1==g?n=s:1==g&&(o=s));f=0.0078125;n=this.lg(a.ub,b,c,e,0,-k,f,n);if(!n)return t;k=this.lg(a.vb,b,c,e,-f,-k,-f,-o);if(!k)return t; e=this.lg(a.wb,b,c,e,f,m,0,-o);if(!e)return t;e={ub:n,vb:k,wb:e};m=e.ub;o=e.vb;k=e.wb;i.save();i.beginPath();i.moveTo(m.x,m.y);i.lineTo(o.x,o.y);i.lineTo(k.x,k.y);i.closePath();i.clip();m=a.ub;o=a.vb;k=a.wb;n=this.ua.Fm;f=512*b;c*=512;b>=n?(a.ub={x:(f+m.x)/n-512,y:(c+m.y)/n},a.vb={x:(f+o.x)/n-512,y:(c+o.y)/n},a.wb={x:(f+k.x)/n-512,y:(c+k.y)/n},a=this.yk(a,e),i.transform(a[0],a[1],a[2],a[3],a[4],a[5]),i.drawImage(this.Jk[1],0,0)):(a.ub={x:(f+m.x)/n,y:(c+m.y)/n},a.vb={x:(f+o.x)/n,y:(c+o.y)/n},a.wb= {x:(f+k.x)/n,y:(c+k.y)/n},a=this.yk(a,e),i.transform(a[0],a[1],a[2],a[3],a[4],a[5]),i.drawImage(this.Jk[0],0,0))}i.restore()},xC:function(a,b,c,e,f,g){if(2==this.ri[b][c].em){var i=this.rg,k=0,m=0,n=0,o=0,s=this.ua.Kp;f&&(1==f?m=s:-1==f&&(k=s));g&&(-1==g?n=s:1==g&&(o=s));f=this.ua.Cm;k=this.lg(a.ub,b,c,e,-f,-k,0,n);if(!k)return t;n=this.lg(a.vb,b,c,e,f,m,f,n);if(!n)return t;e=this.lg(a.wb,b,c,e,0,m,-f,-o);if(!e)return t;e={ub:k,vb:n,wb:e};m=e.ub;o=e.vb;n=e.wb;i.save();i.beginPath();i.moveTo(m.x,m.y); i.lineTo(o.x,o.y);i.lineTo(n.x,n.y);i.closePath();i.clip();a=this.yk(a,e);i.transform(a[0],a[1],a[2],a[3],a[4],a[5]);i.drawImage(this.ri[b][c].we,0,0)}else{i=this.rg;o=n=m=k=0;s=0.0078125;f&&(1==f?m=s:-1==f&&(k=s));g&&(-1==g?n=s:1==g&&(o=s));f=0.0078125;k=this.lg(a.ub,b,c,e,-f,-k,0,n);if(!k)return t;n=this.lg(a.vb,b,c,e,f,m,f,n);if(!n)return t;e=this.lg(a.wb,b,c,e,0,m,-f,-o);if(!e)return t;e={ub:k,vb:n,wb:e};m=e.ub;o=e.vb;n=e.wb;i.save();i.beginPath();i.moveTo(m.x,m.y);i.lineTo(o.x,o.y);i.lineTo(n.x, n.y);i.closePath();i.clip();m=a.ub;o=a.vb;n=a.wb;k=this.ua.Fm;f=512*b;c*=512;b>=k?(a.ub={x:(f+m.x)/k-512,y:(c+m.y)/k},a.vb={x:(f+o.x)/k-512,y:(c+o.y)/k},a.wb={x:(f+n.x)/k-512,y:(c+n.y)/k},a=this.yk(a,e),i.transform(a[0],a[1],a[2],a[3],a[4],a[5]),i.drawImage(this.Jk[1],0,0)):(a.ub={x:(f+m.x)/k,y:(c+m.y)/k},a.vb={x:(f+o.x)/k,y:(c+o.y)/k},a.wb={x:(f+n.x)/k,y:(c+n.y)/k},a=this.yk(a,e),i.transform(a[0],a[1],a[2],a[3],a[4],a[5]),i.drawImage(this.Jk[0],0,0))}i.restore()},lg:function(a,b,c,e,f,g,i,k){e=this.ua; b=2*(1/e.nt*a.x/512+b/e.nt)*Math.PI;c=(0.5-1/e.Fm*a.y/512-c/e.Fm)*Math.PI;a=Math.sin(Math.abs(c));0.4>a?a=0.4:0.98<a&&(a=e.mt);var b=b+(f+g)*a,c=c+(i+k)*a,m=e.Ga,f=Math.cos(c),a=-f*Math.cos(b),c=Math.sin(c),n=f*Math.sin(b),b=e.Nr,f=e.Kt,g=e.Xp,i=e.Yp,k=e.Zp,o=g*a+c*i+n*k;if(0>o)return t;m=m*m/o;a=m*a-g;c=m*c-i;n=m*n-k;o=Math.pow(a,2)+Math.pow(c,2)+Math.pow(n,2);m=Math.sqrt(o);0==o?f=b=0:(o=(a*f+n*b)/m,1<o?o=1:-1>o&&(o=-1),o=Math.acos(o),0>a*b*i+c*f*k-c*b*g-n*i*f&&(o=2*Math.PI-o),b=m*Math.cos(o),f= m*Math.sin(o));return{x:e.a/2+b,y:e.jb/2-f}},xX:function(a){var b=this.W.la();if(b){var c=this.ua,e=c.heading,f=c.Ga,g=c.pitch+c.Jr/180*Math.PI,e=e-c.Pf/180*Math.PI,i=6378137*-(a.lat-b.lat)/180*Math.PI,k=6378137*(a.lng-b.lng)/180*Math.PI,a=Math.sqrt(Math.pow(i,2)+Math.pow(k,2)),m=Math.cos(g),b=Math.cos(e),e=Math.sin(e),n=-f*m*b,g=f*Math.sin(g),m=f*m*e,o=n*i+-2.08*g+k*m;if(0>o)return t;var o=f*f/o,i=o*i-n,f=-2.08*o-g,o=o*k-m,s=Math.pow(i,2)+Math.pow(f,2)+Math.pow(o,2),k=Math.sqrt(s);0==s?e=b=0:(s= (i*e+o*b)/k,1<s?s=1:-1>s&&(s=-1),s=Math.acos(s),0>i*b*g+f*e*m-f*b*n-o*g*e&&(s=2*Math.PI-s),b=k*Math.cos(s),e=k*Math.sin(s));return{x:c.a/2+b,y:c.jb/2-e,Ga:a}}return t},Ja:function(a,b,c){var e=Math.pow(a,2),f=Math.pow(c,2);return{heading:0<c?Math.PI-Math.acos(a/Math.sqrt(e+f)):Math.PI+Math.acos(a/Math.sqrt(e+f)),pitch:Math.asin(b/Math.sqrt(e+Math.pow(b,2)+f))}},yk:function(a,b){var c=a.ub.x,e=a.ub.y,f=a.vb.y,g=a.wb.y,i=b.ub.x,k=b.ub.y,m=b.vb.x,n=b.vb.y,o=b.wb.x,s=b.wb.y,v=f-e,w=g-e,y=a.vb.x-c,z=a.wb.x- c,v=f-e,w=g-e,f=o-i,n=n-k,m=m-i,s=s-k,g=z*v-y*w,v=[(f*v-m*w)/g,(s*v-n*w)/g,(f*y-m*z)/-g,(n*z-s*y)/g];v[4]=i-v[0]*c-v[2]*e;v[5]=k-v[3]*e-v[1]*c;return v}});function vk(a){this.W=a;this.fb=this.ha=q;this.iv=0;this.Ph=a.Ph;this.Wz=new tk;this.Zg={};this.Wn={};this.xo={Th:0.0010,width:0,height:0,heading:0,pitch:0};this.W.ua=this;this.RG=0;this.Sd={};this.ga()} A.extend(vk.prototype,{ga:function(){var a=this,b=a.W;b.addEventListener("size_changed",function(){a.Sd={}});b.addEventListener("zoom_changed_inner",function(){a.Sd={}})},setData:function(a){if(!this.ha||!(a&&a.id==this.ha.id))a?(this.ap(),this.Dl=this.ha?this.ha.id:q,this.MA=this.ha?this.ha.tiles.dirNorth:q,this.jI=this.Sz||q):this.MA=this.Dl=q,this.VI=t,this.Sd={},this.ha=a,this.Sz=this.W.Ja().heading},ap:function(){if(tf()){var a=this.W.Fv.style,b=this.W.Gv.style;a.ac=a.WebkitTransition="";b.ac= b.WebkitTransition="";a.visibility=b.visibility="hidden";a.opacity=b.opacity="0"}for(var c in this.Zg)this.Wn[c]=this.Zg[c],this.Wn[c].style.zIndex="0"},za:function(a,b,c){if(this.ha){var e=a.heading,f=a.pitch,g=this.W,i,k,m,n,o,s;this.Sd[this.ha.id]?(g=this.Sd[this.ha.id],k=g.Pf,m=g.kO,n=g.mO,o=g.gK,i=g.Th,s=g.WB,g=g.VB):(i=this.ha.tiles,k=i.dirNorth,s=g.Ra().clientWidth,g=g.Ra().clientHeight,m=i.Uo(b),n=i.dx(b),o=360/m,i=360/(m*c),this.Sd[this.ha.id]={Pf:k,kO:m,mO:n,gK:o,Th:i,WB:s,VB:g},this.$P()); this.jI=this.Sz||q;this.Sz=e;tf()&&this.UT(e,f,b,c,i,s,g,k,m,n);this.$g=c;k+=e;m=90-f;var f=Math.floor(k/o),e=Math.floor(m/o),v=s/2;k=Math.round(v-k%o/i);0>f&&(k-=c);m=Math.round(g/2-m%o/i);var w,y;this.MA&&(w=this.MA+this.jI,y=Math.round(v-w%o/i),w=Math.floor(w/o));w&&0>w&&(y-=c);o=e-Math.ceil(m/c);v=e+Math.ceil((g-m-c)/c);o=0>o?0:o;var v=v>n-1?n-1:v,z=f+Math.ceil((s-k-c)/c);n=[];for(var B={},c=f-Math.ceil(k/c);c<=z;c++)for(var C=o;C<=v;C++)n.push([c,C]),B[this.iq(this.ha.id,c,C,b)]=p;for(E in this.Zg)if(!B[E]&& !this.Wn[E]&&(c=this.Zg[E]))c.style.display="none";this.iv+=n.length;n.sort(function(a){return function(b,c){return 0.4*Math.abs(b[0]-a[0])+0.6*Math.abs(b[1]-a[1])-(0.4*Math.abs(c[0]-a[0])+0.6*Math.abs(c[1]-a[1]))}}([f,e]));for(c=0;c<n.length;c++)this.VT(n[c][0],n[c][1],b,f,e,k,m,w,y);this.xo.Th=i;this.xo.width=s;this.xo.height=g;this.xo.heading=a.heading;this.xo.pitch=a.pitch}else{for(var E in this.Zg)(c=this.Zg[E])&&c.parentNode&&c.parentNode.removeChild(c),delete this.Zg[E];tf()&&(a=this.W.Fv, b=this.W.Gv,a&&(a.src=b.src="",a.style.visibility=b.style.visibility="hidden"))}},UT:function(a,b,c,e,f,g,i,k,m,n){var c=this.W.Fv,o=this.W.Gv,s=this,e=[m*e,n*e];if(!this.VI||e!==this.RG)this.VI=p,c.style.ac=c.style.WebkitTransition=o.style.ac=o.style.WebkitTransition="opacity 300ms ease-out",c.style.width=o.style.width=e[0]+"px",c.style.height=o.style.height=e[1]+"px",c.style.EU=o.style.EU=e[0]+"px, "+e[1]+"px",c.style.left=Math.round((0-k-a)/f+g/2)+"px",o.style.left=parseInt(c.style.left)+e[0]+ "px",c.onload=function(){-1!=this.src.indexOf("pos=0_0&z=1")&&s.W.dispatchEvent(new P("onthumbnail_complete"))},m="//mapsv0.bdimg.com/scape/?qt=pdata&sid="+this.ha.id+"&pos=0_0&z=1",c.src!=m&&(c.src=o.src=m);this.RG=e;a=Math.round((0-k-a)%360/f+g/2);c.style.top=o.style.top=Math.round(-(90-b)/f+i/2)+"px";0<a&&0>a-e[0]?(c.style.left=a+"px",o.style.left=parseInt(c.style.left)-e[0]+"px"):0<=a-e[0]?(o.style.left=a-e[0]+"px",c.style.left=parseInt(o.style.left)-e[0]+"px"):a+e[0]<g&&0<=a+e[0]?(c.style.left= a+"px",o.style.left=parseInt(c.style.left)+e[0]+"px"):0>a+e[0]?(o.style.left=a+e[0]+"px",c.style.left=parseInt(o.style.left)+e[0]+"px"):(c.style.left=a+"px",o.style.left=a+e[0]+"px")},VT:function(a,b,c,e,f,g,i,k,m){var n=this.ha.tiles,o=this.$g,s=n.Uo(c),v=this.Wn[this.iq(this.Dl,a,b,c)];v&&(v=v.style,v.top=Math.round((b-f)*o+i)+"px",v.left=Math.round((a-(k||e))*o+(m||g))+"px",v.width=v.height=Math.ceil(o)+"px");var k=this.iq(this.ha.id,a,b,c),w=this.Zg[k];if(w)n=w.style,n.top=Math.round((b-f)*o+ i)+"px",n.left=Math.round((a-e)*o+g)+"px",n.width=n.height=Math.ceil(o)+"px",n.zIndex="2",n.display="",this.zf(),w.kB.x=a,w.kB.y=b;else{w=this.Wz.Tw();w.setAttribute("errorCount",0);for(m=a;0>m;)m=s+m;var y=n.getTilesUrl(this.ha.id,new R((m+s)%s,b),c),z=this;w.onload=function(){z.zf();z.Ph.appendChild(this);w.style.opacity="1"};w.onerror=function(){var a=this,b=a.getAttribute("errorCount");if(b<3){b++;setTimeout(function(){a.src=y},100);a.setAttribute("errorCount",b)}else z.zf()};n=w.style;n.position= "absolute";n.zIndex="2";n.border="none";n.display="";n.WebkitUserSelect="none";n.WebkitUserDrag="none";n.width=n.height=Math.ceil(o)+"px";n.top=Math.round((b-f)*o+i)+"px";n.left=Math.round((a-e)*o+g)+"px";n.opacity="0";n.ac=n.WebkitTransition="opacity 300ms ease-out";w.src=y;0<w.width&&(n.opacity="1");w.kB={id:this.ha.id,zoom:c,x:a,y:b};w.ontouchstart=function(a){a.preventDefault()};this.Zg[k]=w}},cS:function(a){var b=this.Zg[a];b&&(delete b.kB,b.onerror=b.onload=b.ontouchstart=q,b.style.display= "none");delete this.Zg[a];delete this.Wn[a];b&&(b.Cz=p,b.src="")},Qc:function(a,b){var c=this.bf;this.bf=b;c!=this.bf&&this.ap()},Kk:function(){this.Sd={}},zf:function(){var a=this;this.iv--;if(0==this.iv){for(var b in this.Wn)(function(){var c=b;setTimeout(function(){a.cS(c)},300)})();this.W.dispatchEvent(new P("ontilesloaded"))}},iq:function(a,b,c,e){var f=this.ha.tiles.Uo(e),g=(b+f)%f;0==e&&(g=(b+2*f)%(2*f));return a+"_"+g+"_"+c+"_"+e},vX:function(a){var b=this.xo,c=this.W.la();if(c){var e=6378137* -(a.lat-c.lat)/180*Math.PI,f=6378137*(a.lng-c.lng)/180*Math.PI,a=Math.sqrt(Math.pow(e,2)+Math.pow(f,2)),c=b.heading%360-b.Th*b.width/2,g=b.pitch+b.Th*b.height/2,e=this.Ja(e,-2.08,f);return{x:(180*(e.heading%360/Math.PI)-c)/b.Th,y:(g-180*(e.pitch/Math.PI))/b.Th,Ga:a}}return t},Ja:function(a,b,c){var e=Math.pow(a,2),f=Math.pow(c,2);return{heading:0<c?Math.PI-Math.acos(a/Math.sqrt(e+f)):Math.PI+Math.acos(a/Math.sqrt(e+f)),pitch:Math.asin(b/Math.sqrt(e+Math.pow(b,2)+f))}},$P:function(){var a=this.W,b= a.gh().height/2*this.Sd[this.ha.id].Th;a.u_(-90+b,90-b)}});function lk(a){this.W=a;a.oA=this;this.bg=[];this.DG=[];this.dq=[];this.CG=[];this.ll=[];this.DH=[];this.Ev=[];this.sE=this.cI=this.bI=this.Gu=this.Fu=0;this.uw={};this.ct=this.Ax=t;Pb()?this.ff=this.pz():Qb()?(this.Rb=this.mz(),this.oq=this.Rb.getContext("2d"),this.KP(),this.Fn=[]):Ob()&&(this.Qv=this.GQ());this.fb=q;this.Dy="#549eef";this.Sd={};this.Jj=this.Pi=p;this.ga()} var yk=[[0,-11],[4,-6.5],[2,-6.5],[2,-3],[-2,-3],[-2,-6.5],[-4,-6.5]],zk=[[5,-2],[5,-12],[-5,-12],[-5,-2]],Ak=[[0,-110],[40,-65],[20,-65],[20,-30],[-20,-30],[-20,-65],[-40,-65]],Bk=[[45,-20],[45,-120],[-45,-120],[-45,-20]],Ck="\\u5317 \\u4e1c\\u5317 \\u4e1c \\u4e1c\\u5357 \\u5357 \\u897f\\u5357 \\u897f \\u897f\\u5317 \\u5317".split(" "); A.extend(lk.prototype,{pz:function(){var a=L("svg",{version:"1.1",overflow:"hidden"},"http://www.w3.org/2000/svg"),b=this.W,c=b.Ra().clientWidth,e=b.Ra().clientHeight;this.ff=a;this.Fu=c;this.Gu=e;this.bI=b.Ra().offsetLeft||0;this.cI=b.Ra().offsetTop||0;this.HI(c,e);a.style.position="absolute";a.style.left="0";a.style.top="0";a.style.WebkitUserSelect=a.style.hP=a.style.MozUserSelect="none";b.Rj.appendChild(a);Pb()&&"cvsRender"==this.W.$j&&this.n_(a);return a},n_:function(a){var b=this,c=L("ellipse", {fill:"white","fill-rule":"evenodd","fill-opacity":"0.4",cx:"100",cy:"100",rx:"20",ry:"20"},"http://www.w3.org/2000/svg");c.setAttribute("visibility","hidden");this.BC=c;a.appendChild(c);a=this.W.Ra();A.V(a,"mousedown",function(a){b.sE=(new Date).valueOf();b.WZ(a.offsetX||a.layerX||0,a.offsetY||a.layerY||0)});A.V(a,"mouseup",function(){200>(new Date).valueOf()-b.sE&&(b.Ax&&b.W.m.visible)&&b.click();b.sE=0});A.V(a,"mousemove",function(a){b.XZ(a.offsetX||a.layerX||0,a.offsetY||a.layerY||0);b.h_(a.offsetX|| a.layerX||0,a.offsetY||a.layerY||0)});A.fa.Re?A.V(a,"mouseout",function(a){var c=a.clientX||a.pageX||0,a=a.clientY||a.pageY||0,c=c-b.bI,a=a-b.cI;(40>Math.abs(Math.abs(c-b.Fu/2)-b.Fu/2)||40>Math.abs(Math.abs(a-b.Gu/2)-b.Gu/2))&&b.BC.setAttribute("visibility","hidden")}):A.V(a,"mouseout",function(){b.BC.setAttribute("visibility","hidden")});b.W.addEventListener("hide_ellipse",function(){b.ct=p});b.W.addEventListener("show_ellipse",function(){b.ct=t})},mz:function(){var a=L("canvas"),b=this.W,c=b.Ra().clientWidth, e=b.Ra().clientHeight;this.Rb=a;a.width=c;a.height=e;var f=a.style;f.position="absolute";f.top=f.left="0";f.width=c+"px";f.height=e+"px";f.f1="rgba(0, 0, 0, 0)";b.Rj.appendChild(a);return a},GQ:function(){var a=this.W.Ra(),b=a.clientWidth,a=a.clientHeight;return Db(this.W.Rj,[\'<v:group style="behavior:url(#default#VML);z-index:1;width:\',b+"px;height:"+a+\'px;position:absolute;left:0;top:0;"\',\'coordsize="\'+b+","+a+\'" \',\'coordorigin="-\'+b/2+",-"+0.75*a+\'">\',"</v:group>"].join(""))},ga:function(){var a= this,b=a.W;b.addEventListener("size_changed",function(b){b=b.size;a.Be(b.width,b.height);a.Sd={}});b.addEventListener("zoom_changed_inner",function(){a.Sd={}})},Be:function(a,b){if(Pb())this.HI(a,b);else if(Qb()){var c=this.Rb;c.width=a;c.height=b;c.style.width=a+"px";c.style.height=b+"px"}},HI:function(a,b){this.ff&&(this.ff.setAttribute("width",a+"px"),this.ff.setAttribute("height",b+"px"),this.ff.setAttribute("viewBox","0 0 "+a+" "+b),this.Fu=a,this.Gu=b)},setData:ba("ha"),za:function(a,b,c,e){if(this.ha){this.Ka= a;this.Lc=b;this.$g=c;var f=(a.heading+360)%360,a=a.pitch,g=this.W,i=this.ha.tiles,k,m,n;this.Sd[this.ha.id]?(c=this.Sd[this.ha.id],k=c.WB,m=c.VB,c=c.Th):(k=g.Ra().clientWidth,m=g.Ra().clientHeight,n=i.Uo(b),b=i.dx(b),c=360/(n*c),this.Sd[this.ha.id]={WB:k,VB:m,kO:n,mO:b,gK:360/n,Th:c});g=g.ja()+1;g=0.75*m+1*(a/c)/g;g<m/2&&(g=m/2);m=(90-a)/200;c=10;Pb()?this.lI(this.ha.id,this.ha.links):Qb()?(this.oq.clearRect(0,0,this.Rb.width,this.Rb.height),this.ha.id!=this.fb&&(this.Fn.length=0)):Ob()&&(c=36,this.hT(this.ha.id, this.ha.links));for(n=0;n<this.ha.links.length;n++){var b=this.ha.links[n].dir-f,b=(360+b)%360,i=k/2+50*Math.sin(U(b)),o=g-60*Math.cos(U(b))*m;if(Pb())this.OQ(n,[k/2,g],[c,c*m],b),this.YQ(n,[i,o]);else if(Qb()){var s="#444";e==n&&(s=this.Dy);this.VG([k/2,g+3],[c,c*m],b,"#000",0.4);this.VG([k/2,g],[c,c*m],b,"#fff",0.95,s);this.ZQ(n,[i,o],s);b=[k/2+60*Math.sin(U(b)),g-50*Math.cos(U(b))*m];this.Fn[n]=[Math.round(b[0]),Math.round(b[1])]}else Ob()&&(i=1,-30<a&&(i=80>a- -30?i+Math.tan(U(a- -30)):i+6),i= -Math.sin(U(Math.min(a,-30)))/i,this.Qv.coordorigin=Math.round(-k/2)+","+Math.round(-g+40),this.PQ(n,b,i))}}else Pb()?this.lI(q,[]):(this.oq.clearRect(0,0,this.Rb.width,this.Rb.height),this.Fn.length=0)},lI:function(a,b){if(a!=this.fb){this.fb=a;linksCount=b.length;if(linksCount>this.bg.length){for(var c=linksCount-this.bg.length,e=this.ff,f=0;f<c;f++){var g=L("path",{fill:"black","fill-rule":"evenodd","fill-opacity":"0.4",stroke:"none"},"http://www.w3.org/2000/svg"),i=L("path",{fill:"white","fill-rule":"evenodd", "fill-opacity":"0.9",stroke:"#444","stroke-width":"0.2","stroke-linecap":"round"},"http://www.w3.org/2000/svg"),k=["M"],m=yk;k.push(m[0][0]);k.push(m[0][1]);for(var n=1;n<m.length;n++)k.push("L"),k.push(m[n][0]),k.push(m[n][1]);k.push(m[0][0]);k.push(m[0][1]);g.setAttribute("d",k.join(" "));this.dq.push(g);e.appendChild(g);i.setAttribute("d",k.join(" "));this.bg.push(i);e.appendChild(i);n=L("text",{fill:"#444","fill-rule":"evenodd",stroke:"none","font-size":"16px","font-family":"arial","text-anchor":"middle", "alignment-baseline":"middle"},"http://www.w3.org/2000/svg");n.style.WebkitUserSelect=n.style.hP=n.style.MozUserSelect="none";this.Ev.push(n);e.appendChild(n);var g=L("path",{fill:"white","fill-rule":"evenodd","fill-opacity":"0",stroke:"none",cursor:"pointer"},"http://www.w3.org/2000/svg"),o=this;g.AG=i;g.UI=n;g.style.MozUserSelect="none";i=["M"];k=zk;i.push(k[0][0]);i.push(k[0][1]);for(n=1;n<k.length;n++)i.push("L"),i.push(k[n][0]),i.push(k[n][1]);g.setAttribute("d",i.join(" "));A.V(g,I()?"touchstart": "mousedown",function(a){o.Zn={heading:o.Ka.heading,pitch:o.Ka.pitch};o.pq=this;this.AG.setAttribute("stroke",o.Dy);this.UI.setAttribute("fill",o.Dy);Fb(a)});this.ll.push(g);e.appendChild(g);A.V(g,"mousemove",function(){o.ct=p});A.V(g,"mouseout",function(){o.ct=t})}A.V(this.W.R,I()?"touchend":"mouseup",function(a){if(o.pq){if(o.Ka.heading==o.Zn.heading&&o.Ka.pitch==o.Zn.pitch){var b=o.pq.getAttribute("sid");b&&(o.W.dispatchEvent(new P("onlinkclick")),o.W.Cc(b));o.T1=o.U1=q}o.pq.AG.setAttribute("stroke", "#444");o.pq.UI.setAttribute("fill","#444");o.Zn=q;o.pq=q;a.stopPropagation()}})}for(f=0;f<this.bg.length;f++)c="",f<linksCount?(e=this.Ev[f],0<e.childNodes.length&&e.removeChild(e.childNodes[0]),n=this.lH(b[f].dir),e.appendChild(document.createTextNode(n)),this.ll[f].setAttribute("sid",b[f].id)):c="none",this.bg[f].style.display=c,this.dq[f].style.display=c,this.Ev[f].style.display=c,this.ll[f].style.display=c}},KP:function(){var a=this,b=a.W;A.V(this.Rb,"touchstart",function(b){a.Zn={heading:a.Ka.heading, pitch:a.Ka.pitch};var e=Eb(a.Rb);a.Yu=a.ZK(b.touches[0].clientX-e.left,b.touches[0].clientY-e.top);a.za(a.Ka,a.Lc,a.$g,a.Yu)});A.V(this.Rb,"touchend",function(){a.Ka.heading==a.Zn.heading&&a.Ka.pitch==a.Zn.pitch&&a.ha.links[a.Yu]&&(b.dispatchEvent(new P("onlinkclick")),b.Cc(a.ha.links[a.Yu].id));a.Yu=q})},ZK:function(a,b){for(var c=0;c<this.Fn.length;c++)if(30>Math.abs(a-this.Fn[c][0])&&30>Math.abs(b-this.Fn[c][1]))return c;return-1},hT:function(a,b){if(a!=this.fb){this.fb=a;linksCount=b.length;if(linksCount> this.bg.length)for(var c=linksCount-this.bg.length,e=0;e<c;e++){for(var f=[],g=Ak,i=0;i<g.length;i++)f.push(g[i][0]),f.push(g[i][1]);f.push(g[0][0]);f.push(g[0][1]);i=Db(this.Qv,["<v:polyline ",\'points="\'+f.join(" ")+\'"\',\' style="behavior:url(#default#VML);z-index:1;left:0;top:0;" stroked="false"><v:fill style="behavior:url(#default#VML)" color="black" opacity="0.5"></v:fill><v:skew style="behavior:url(#default#VML)" on="true" origin="0,1.5" matrix="1,0,0,1,0,0" offset="0,0.05"></v:skew></v:polyline>\'].join("")); this.dq.push(i);this.CG.push(i.getElementsByTagName("skew")[0]);i=Db(this.Qv,["<v:polyline ",\'points="\'+f.join(" ")+\'"\',\'fillcolor="white" stroked="true" strokecolor="#444" strokeweight="1"  style="behavior:url(#default#VML);z-index:2;left:0;top:0;"><v:fill style="behavior:url(#default#VML)" color="white" opacity="1"></v:fill><v:skew style="behavior:url(#default#VML)" on="true" origin="0,1.5" matrix="1,0,0,1,0,0" offset="0,0"></v:skew></v:polyline>\'].join(""));this.bg.push(i);this.DG.push(i.getElementsByTagName("skew")[0]); f=[];g=Bk;for(i=0;i<g.length;i++)f.push(g[i][0]),f.push(g[i][1]);var i=Db(this.Qv,[\'<v:polyline style="cursor:pointer;z-index:3;behavior:url(#default#VML);"\',\' points="\'+f.join(" ")+\'" stroked="false">\',\'<v:fill style="behavior:url(#default#VML);" color="white" opacity="0"></v:fill><v:skew style="behavior:url(#default#VML);" on="true" origin="0,1.2" matrix="1,0,0,1,0,0"></v:skew></v:polyline>\'].join("")),k=this;A.V(i,"click",function(a){(a=a.srcElement.sid)&&k.W.Cc(a)});this.ll.push(i);this.DH.push(i.getElementsByTagName("skew")[0])}for(e= 0;e<this.bg.length;e++)c="",e<linksCount?this.ll[e].sid=b[e].id:c="none",this.bg[e].style.display=c,this.dq[e].style.display=c,this.ll[e].style.display=c}},OQ:function(a,b,c,e){this.bg[a]&&(this.bg[a].setAttribute("transform","translate("+b[0]+" "+b[1]+")scale("+c[0]+" "+c[1]+")rotate("+e+")"),this.dq[a].setAttribute("transform","translate("+b[0]+" "+(b[1]+4)+")scale("+c[0]+" "+c[1]+")rotate("+e+")"),this.ll[a].setAttribute("transform","translate("+b[0]+" "+b[1]+")scale("+c[0]+" "+c[1]+")rotate("+ e+")"))},YQ:function(a,b){this.Ev[a].setAttribute("transform","translate("+b[0]+" "+b[1]+")")},PQ:function(a,b,c){this.Ty(this.DG[a],b,0,c);this.Ty(this.CG[a],b,0.6,c);this.Ty(this.DH[a],b,0,c)},Ty:function(a,b,c,e){var f=U(b),b=Math.cos(f),f=Math.sin(f);a.matrix=[Number(b).toFixed(4),Number(-f).toFixed(4),Number(f*e).toFixed(4),Number(b*e).toFixed(4),0,0].join();a.offset="0,"+Math.round(50*c)/1E3},VG:function(a,b,c,e,f,g){var i=this.oq;i.save();i.fillStyle=e;i.globalAlpha=f;i.translate(a[0],a[1]); i.scale(b[0],b[1]);i.rotate(U(c));i.beginPath();i.moveTo(yk[0][0],yk[0][1]);for(a=1;a<yk.length;a++)i.lineTo(yk[a][0],yk[a][1]);i.closePath();i.fill();g&&(i.lineWidth="0.2",i.lineCap="round",i.lineJoin="round",i.strokeStyle=g,i.stroke());i.restore()},ZQ:function(a,b,c){var e=this.oq;e.save();a=this.lH(this.ha.links[a].dir);e.font="16px sans-serif";e.textAlign="center";e.textBaseline="middle";e.fillStyle=c;e.fillText(a,b[0],b[1]);e.restore()},lH:function(a){return Ck[Math.ceil(Math.floor((a+360)%360/ 22.5)/2)]},wL:da(0),click:function(){if(!(2<Math.abs(this.$V-this.ZY)||2<Math.abs(this.mK-this.mK))){var a=this.uw;if(a){for(var b=this.ha.links,c=this.fX(a.nG,a.oG),e=30,f=0,g=0;g<b.length;g++)f=b[g].dir-c,f=180<Math.abs(f)?b[g].dir>c?360+c-b[g].dir:360-c+b[g].dir:Math.abs(f),f<e&&(e=f);29>e&&(b=this.W.la(),this.W.va(new Q(b.lng+180*a.oG/Math.PI/6378137,b.lat-180*a.nG/Math.PI/6378137)))}}},WZ:function(a,b){this.$V=a;this.mK=b},XZ:ba("ZY"),h_:function(a,b){this.uw=coord=this.W.ua.hD(a,b);var c=this.BC; if(coord&&!this.ct&&this.W.m.visible){c.setAttribute("cx",a);c.setAttribute("cy",b);var e=Math.abs(2*coord.ME/(coord.Ga-2)-2*coord.ME/(coord.Ga+2))/2,f=2*coord.ME/coord.Ga;if(4<coord.Ga){if(100<f){var g=f/100,f=100,e=e/g;e>f&&(e=f)}c.setAttribute("rx",f);c.setAttribute("ry",e);c.setAttribute("visibility","visible");this.Ax=p}else this.Ax=t,c.setAttribute("visibility","hidden")}else this.Ax=t,c.setAttribute("visibility","hidden")},fX:function(a,b){var c=0;0<a?c=180*(Math.atan(b/a)/Math.PI):0>a?c=180* (Math.atan(b/a)/Math.PI)+180:0==a&&(c=0<b?90:-90);heading=180-c;360<heading?heading-=360:0>heading&&(heading+=360);return heading},$:function(){this.Pi=t;this.W.Rj&&(this.W.Rj.style.visibility="hidden")},show:function(){this.Pi=p;this.W.Rj&&(this.W.Rj.style.visibility="visible")},DC:function(){this.Jj=p},lC:function(){this.Jj=t}});var Dk={get:function(a,b){var c="inst_"+b;Dk[c]||(Dk[c]=new Ek(a));return Dk[c]}};function Ek(a){this.nb=a;this.tu=new Uint8Array(16);this.xq=new Uint8Array(16)}A.extend(Ek.prototype,{ND:function(){for(var a=0,b=this.tu.length;a<b;a++)this.tu[a]=0},Eo:function(a){this.tu[a]=1;0===this.xq[a]&&(this.nb.enableVertexAttribArray(a),this.xq[a]=1)},oC:function(){for(var a=0,b=this.xq.length;a<b;a++)this.xq[a]!==this.tu[a]&&(this.nb.disableVertexAttribArray(a),this.xq[a]=0)}});if(!Fk)var Fk=1.0E-6;if(!Gk)var Gk="undefined"!==typeof Float32Array?Float32Array:Array;if(!Hk)var Hk=Math.random;var Ik={B5:function(a){Gk=a}};"undefined"!==typeof exports&&(exports.N3=Ik);var Jk=Math.PI/180;Ik.O5=function(a){return a*Jk}; var Kk={create:function(){var a=new Gk(2);a[0]=0;a[1]=0;return a},Vh:function(a){var b=new Gk(2);b[0]=a[0];b[1]=a[1];return b},ug:function(a,b){var c=new Gk(2);c[0]=a;c[1]=b;return c},copy:function(a,b){a[0]=b[0];a[1]=b[1];return a},set:function(a,b,c){a[0]=b;a[1]=c;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return a},Tt:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];return a}};Kk.sub=Kk.Tt;Kk.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];return a};Kk.Am=Kk.multiply; Kk.$r=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];return a};Kk.kK=Kk.$r;Kk.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);return a};Kk.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);return a};Kk.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;return a};Kk.zN=function(a,b,c,e){a[0]=b[0]+c[0]*e;a[1]=b[1]+c[1]*e;return a};Kk.lc=function(a,b){var c=b[0]-a[0],e=b[1]-a[1];return Math.sqrt(c*c+e*e)};Kk.Ga=Kk.lc; Kk.Pt=function(a,b){var c=b[0]-a[0],e=b[1]-a[1];return c*c+e*e};Kk.WN=Kk.Pt;Kk.length=function(a){var b=a[0],a=a[1];return Math.sqrt(b*b+a*a)};Kk.hE=Kk.length;Kk.Qk=function(a){var b=a[0],a=a[1];return b*b+a*a};Kk.jF=Kk.Qk;Kk.EM=function(a,b){a[0]=-b[0];a[1]=-b[1];return a};Kk.normalize=function(a,b){var c=b[0],e=b[1],c=c*c+e*e;if(c>0){c=1/Math.sqrt(c);a[0]=b[0]*c;a[1]=b[1]*c}return a};Kk.cs=function(a,b){return a[0]*b[0]+a[1]*b[1]};Kk.ww=function(a,b,c){b=b[0]*c[1]-b[1]*c[0];a[0]=a[1]=0;a[2]=b;return a}; Kk.yx=function(a,b,c,e){var f=b[0],b=b[1];a[0]=f+e*(c[0]-f);a[1]=b+e*(c[1]-b);return a};Kk.random=function(a,b){var b=b||1,c=Hk()*2*Math.PI;a[0]=Math.cos(c)*b;a[1]=Math.sin(c)*b;return a};Kk.X5=function(a,b,c){var e=b[0],b=b[1];a[0]=c[0]*e+c[2]*b;a[1]=c[1]*e+c[3]*b;return a};Kk.Y5=function(a,b,c){var e=b[0],b=b[1];a[0]=c[0]*e+c[2]*b+c[4];a[1]=c[1]*e+c[3]*b+c[5];return a};Kk.k0=function(a,b,c){var e=b[0],b=b[1];a[0]=c[0]*e+c[3]*b+c[6];a[1]=c[1]*e+c[4]*b+c[7];return a}; Kk.oO=function(a,b,c){var e=b[0],b=b[1];a[0]=c[0]*e+c[4]*b+c[12];a[1]=c[1]*e+c[5]*b+c[13];return a};Kk.forEach=function(){var a=Kk.create();return function(b,c,e,f,g,i){c||(c=2);e||(e=0);for(f=f?Math.min(f*c+e,b.length):b.length;e<f;e=e+c){a[0]=b[e];a[1]=b[e+1];g(a,a,i);b[e]=a[0];b[e+1]=a[1]}return b}}();Kk.Rm=function(a){return"vec2("+a[0]+", "+a[1]+")"};"undefined"!==typeof exports&&(exports.e6=Kk); var Lk={create:function(){var a=new Gk(3);a[0]=0;a[1]=0;a[2]=0;return a},Vh:function(a){var b=new Gk(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},ug:function(a,b,c){var e=new Gk(3);e[0]=a;e[1]=b;e[2]=c;return e},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,c,e){a[0]=b;a[1]=c;a[2]=e;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a},Tt:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a}};Lk.sub=Lk.Tt; Lk.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return a};Lk.Am=Lk.multiply;Lk.$r=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a};Lk.kK=Lk.$r;Lk.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);return a};Lk.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a};Lk.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a}; Lk.zN=function(a,b,c,e){a[0]=b[0]+c[0]*e;a[1]=b[1]+c[1]*e;a[2]=b[2]+c[2]*e;return a};Lk.lc=function(a,b){var c=b[0]-a[0],e=b[1]-a[1],f=b[2]-a[2];return Math.sqrt(c*c+e*e+f*f)};Lk.Ga=Lk.lc;Lk.Pt=function(a,b){var c=b[0]-a[0],e=b[1]-a[1],f=b[2]-a[2];return c*c+e*e+f*f};Lk.WN=Lk.Pt;Lk.length=function(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)};Lk.hE=Lk.length;Lk.Qk=function(a){var b=a[0],c=a[1],a=a[2];return b*b+c*c+a*a};Lk.jF=Lk.Qk; Lk.EM=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};Lk.normalize=function(a,b){var c=b[0],e=b[1],f=b[2],c=c*c+e*e+f*f;if(c>0){c=1/Math.sqrt(c);a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c}return a};Lk.cs=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};Lk.ww=function(a,b,c){var e=b[0],f=b[1],b=b[2],g=c[0],i=c[1],c=c[2];a[0]=f*c-b*i;a[1]=b*g-e*c;a[2]=e*i-f*g;return a};Lk.yx=function(a,b,c,e){var f=b[0],g=b[1],b=b[2];a[0]=f+e*(c[0]-f);a[1]=g+e*(c[1]-g);a[2]=b+e*(c[2]-b);return a}; Lk.random=function(a,b){var b=b||1,c=Hk()*2*Math.PI,e=Hk()*2-1,f=Math.sqrt(1-e*e)*b;a[0]=Math.cos(c)*f;a[1]=Math.sin(c)*f;a[2]=e*b;return a};Lk.oO=function(a,b,c){var e=b[0],f=b[1],b=b[2];a[0]=c[0]*e+c[4]*f+c[8]*b+c[12];a[1]=c[1]*e+c[5]*f+c[9]*b+c[13];a[2]=c[2]*e+c[6]*f+c[10]*b+c[14];return a};Lk.k0=function(a,b,c){var e=b[0],f=b[1],b=b[2];a[0]=e*c[0]+f*c[3]+b*c[6];a[1]=e*c[1]+f*c[4]+b*c[7];a[2]=e*c[2]+f*c[5]+b*c[8];return a}; Lk.m0=function(a,b,c){var e=b[0],f=b[1],g=b[2],b=c[0],i=c[1],k=c[2],c=c[3],m=c*e+i*g-k*f,n=c*f+k*e-b*g,o=c*g+b*f-i*e,e=-b*e-i*f-k*g;a[0]=m*c+e*-b+n*-k-o*-i;a[1]=n*c+e*-i+o*-b-m*-k;a[2]=o*c+e*-k+m*-i-n*-b;return a};Lk.tN=function(a,b,c,e){var f=[],g=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];g[0]=f[0];g[1]=f[1]*Math.cos(e)-f[2]*Math.sin(e);g[2]=f[1]*Math.sin(e)+f[2]*Math.cos(e);a[0]=g[0]+c[0];a[1]=g[1]+c[1];a[2]=g[2]+c[2];return a}; Lk.uN=function(a,b,c,e){var f=[],g=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];g[0]=f[2]*Math.sin(e)+f[0]*Math.cos(e);g[1]=f[1];g[2]=f[2]*Math.cos(e)-f[0]*Math.sin(e);a[0]=g[0]+c[0];a[1]=g[1]+c[1];a[2]=g[2]+c[2];return a};Lk.vN=function(a,b,c,e){var f=[],g=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];g[0]=f[0]*Math.cos(e)-f[1]*Math.sin(e);g[1]=f[0]*Math.sin(e)+f[1]*Math.cos(e);g[2]=f[2];a[0]=g[0]+c[0];a[1]=g[1]+c[1];a[2]=g[2]+c[2];return a}; Lk.forEach=function(){var a=Lk.create();return function(b,c,e,f,g,i){c||(c=3);e||(e=0);for(f=f?Math.min(f*c+e,b.length):b.length;e<f;e=e+c){a[0]=b[e];a[1]=b[e+1];a[2]=b[e+2];g(a,a,i);b[e]=a[0];b[e+1]=a[1];b[e+2]=a[2]}return b}}();Lk.Rm=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof exports&&(exports.f6=Lk); var pk={create:function(){var a=new Gk(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a},Vh:function(a){var b=new Gk(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},ug:function(a,b,c,e){var f=new Gk(4);f[0]=a;f[1]=b;f[2]=c;f[3]=e;return f},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,c,e,f){a[0]=b;a[1]=c;a[2]=e;a[3]=f;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a},Tt:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]- c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a}};pk.sub=pk.Tt;pk.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];a[3]=b[3]*c[3];return a};pk.Am=pk.multiply;pk.$r=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];a[3]=b[3]/c[3];return a};pk.kK=pk.$r;pk.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);a[3]=Math.min(b[3],c[3]);return a}; pk.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);a[3]=Math.max(b[3],c[3]);return a};pk.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a};pk.zN=function(a,b,c,e){a[0]=b[0]+c[0]*e;a[1]=b[1]+c[1]*e;a[2]=b[2]+c[2]*e;a[3]=b[3]+c[3]*e;return a};pk.lc=function(a,b){var c=b[0]-a[0],e=b[1]-a[1],f=b[2]-a[2],g=b[3]-a[3];return Math.sqrt(c*c+e*e+f*f+g*g)};pk.Ga=pk.lc; pk.Pt=function(a,b){var c=b[0]-a[0],e=b[1]-a[1],f=b[2]-a[2],g=b[3]-a[3];return c*c+e*e+f*f+g*g};pk.WN=pk.Pt;pk.length=function(a){var b=a[0],c=a[1],e=a[2],a=a[3];return Math.sqrt(b*b+c*c+e*e+a*a)};pk.hE=pk.length;pk.Qk=function(a){var b=a[0],c=a[1],e=a[2],a=a[3];return b*b+c*c+e*e+a*a};pk.jF=pk.Qk;pk.EM=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a}; pk.normalize=function(a,b){var c=b[0],e=b[1],f=b[2],g=b[3],c=c*c+e*e+f*f+g*g;if(c>0){c=1/Math.sqrt(c);a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c}return a};pk.cs=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};pk.yx=function(a,b,c,e){var f=b[0],g=b[1],i=b[2],b=b[3];a[0]=f+e*(c[0]-f);a[1]=g+e*(c[1]-g);a[2]=i+e*(c[2]-i);a[3]=b+e*(c[3]-b);return a};pk.random=function(a,b){b=b||1;a[0]=Hk();a[1]=Hk();a[2]=Hk();a[3]=Hk();pk.normalize(a,a);pk.scale(a,a,b);return a}; pk.oO=function(a,b,c){var e=b[0],f=b[1],g=b[2],b=b[3];a[0]=c[0]*e+c[4]*f+c[8]*g+c[12]*b;a[1]=c[1]*e+c[5]*f+c[9]*g+c[13]*b;a[2]=c[2]*e+c[6]*f+c[10]*g+c[14]*b;a[3]=c[3]*e+c[7]*f+c[11]*g+c[15]*b;return a};pk.m0=function(a,b,c){var e=b[0],f=b[1],g=b[2],b=c[0],i=c[1],k=c[2],c=c[3],m=c*e+i*g-k*f,n=c*f+k*e-b*g,o=c*g+b*f-i*e,e=-b*e-i*f-k*g;a[0]=m*c+e*-b+n*-k-o*-i;a[1]=n*c+e*-i+o*-b-m*-k;a[2]=o*c+e*-k+m*-i-n*-b;return a}; pk.forEach=function(){var a=pk.create();return function(b,c,e,f,g,i){c||(c=4);e||(e=0);for(f=f?Math.min(f*c+e,b.length):b.length;e<f;e=e+c){a[0]=b[e];a[1]=b[e+1];a[2]=b[e+2];a[3]=b[e+3];g(a,a,i);b[e]=a[0];b[e+1]=a[1];b[e+2]=a[2];b[e+3]=a[3]}return b}}();pk.Rm=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof exports&&(exports.g6=pk); var Mk={create:function(){var a=new Gk(4);a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},Vh:function(a){var b=new Gk(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},tm:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},rO:function(a,b){if(a===b){var c=b[1];a[1]=b[2];a[2]=c}else{a[0]=b[0];a[1]=b[2];a[2]=b[1];a[3]=b[3]}return a},$o:function(a,b){var c=b[0],e=b[1],f=b[2],g=b[3],i=c*g-f*e;if(!i)return q;i=1/i;a[0]=g*i;a[1]=-e*i;a[2]=-f*i; a[3]=c*i;return a},vJ:function(a,b){var c=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=c;return a},iC:function(a){return a[0]*a[3]-a[2]*a[1]},multiply:function(a,b,c){var e=b[0],f=b[1],g=b[2],b=b[3],i=c[0],k=c[1],m=c[2],c=c[3];a[0]=e*i+g*k;a[1]=f*i+b*k;a[2]=e*m+g*c;a[3]=f*m+b*c;return a}};Mk.Am=Mk.multiply;Mk.rotate=function(a,b,c){var e=b[0],f=b[1],g=b[2],b=b[3],i=Math.sin(c),c=Math.cos(c);a[0]=e*c+g*i;a[1]=f*c+b*i;a[2]=e*-i+g*c;a[3]=f*-i+b*c;return a}; Mk.scale=function(a,b,c){var e=b[1],f=b[2],g=b[3],i=c[0],c=c[1];a[0]=b[0]*i;a[1]=e*i;a[2]=f*c;a[3]=g*c;return a};Mk.Rm=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};Mk.WC=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};Mk.Y0=function(a,b,c,e){a[2]=e[2]/e[0];c[0]=e[0];c[1]=e[1];c[3]=e[3]-a[2]*c[1];return[a,b,c]};"undefined"!==typeof exports&&(exports.B4=Mk); var Nk={create:function(){var a=new Gk(6);a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},Vh:function(a){var b=new Gk(6);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},tm:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},$o:function(a,b){var c=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],m=c*g-e*f;if(!m)return q;m=1/m;a[0]=g*m;a[1]=-e*m;a[2]=-f*m;a[3]=c*m;a[4]=(f*k-g*i)*m;a[5]= (e*i-c*k)*m;return a},iC:function(a){return a[0]*a[3]-a[1]*a[2]},multiply:function(a,b,c){var e=b[0],f=b[1],g=b[2],i=b[3],k=b[4],b=b[5],m=c[0],n=c[1],o=c[2],s=c[3],v=c[4],c=c[5];a[0]=e*m+g*n;a[1]=f*m+i*n;a[2]=e*o+g*s;a[3]=f*o+i*s;a[4]=e*v+g*c+k;a[5]=f*v+i*c+b;return a}};Nk.Am=Nk.multiply;Nk.rotate=function(a,b,c){var e=b[0],f=b[1],g=b[2],i=b[3],k=b[4],b=b[5],m=Math.sin(c),c=Math.cos(c);a[0]=e*c+g*m;a[1]=f*c+i*m;a[2]=e*-m+g*c;a[3]=f*-m+i*c;a[4]=k;a[5]=b;return a}; Nk.scale=function(a,b,c){var e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],m=c[0],c=c[1];a[0]=b[0]*m;a[1]=e*m;a[2]=f*c;a[3]=g*c;a[4]=i;a[5]=k;return a};Nk.translate=function(a,b,c){var e=b[0],f=b[1],g=b[2],i=b[3],k=b[4],b=b[5],m=c[0],c=c[1];a[0]=e;a[1]=f;a[2]=g;a[3]=i;a[4]=e*m+g*c+k;a[5]=f*m+i*c+b;return a};Nk.Rm=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"}; Nk.WC=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};"undefined"!==typeof exports&&(exports.C4=Nk); var Ok={create:function(){var a=new Gk(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},V2:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a},Vh:function(a){var b=new Gk(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},tm:function(a){a[0]= 1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},rO:function(a,b){if(a===b){var c=b[1],e=b[2],f=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=e;a[7]=f}else{a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8]}return a},$o:function(a,b){var c=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],m=b[6],n=b[7],o=b[8],s=o*i-k*n,v=-o*g+k*m,w=n*g-i*m,y=c*s+e*v+f*w;if(!y)return q;y=1/y;a[0]=s*y;a[1]=(-o*e+f*n)*y;a[2]=(k*e-f*i)*y;a[3]=v*y;a[4]=(o*c-f*m)*y;a[5]= (-k*c+f*g)*y;a[6]=w*y;a[7]=(-n*c+e*m)*y;a[8]=(i*c-e*g)*y;return a},vJ:function(a,b){var c=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],m=b[6],n=b[7],o=b[8];a[0]=i*o-k*n;a[1]=f*n-e*o;a[2]=e*k-f*i;a[3]=k*m-g*o;a[4]=c*o-f*m;a[5]=f*g-c*k;a[6]=g*n-i*m;a[7]=e*m-c*n;a[8]=c*i-e*g;return a},iC:function(a){var b=a[3],c=a[4],e=a[5],f=a[6],g=a[7],i=a[8];return a[0]*(i*c-e*g)+a[1]*(-i*b+e*f)+a[2]*(g*b-c*f)},multiply:function(a,b,c){var e=b[0],f=b[1],g=b[2],i=b[3],k=b[4],m=b[5],n=b[6],o=b[7],b=b[8],s=c[0],v=c[1],w= c[2],y=c[3],z=c[4],B=c[5],C=c[6],E=c[7],c=c[8];a[0]=s*e+v*i+w*n;a[1]=s*f+v*k+w*o;a[2]=s*g+v*m+w*b;a[3]=y*e+z*i+B*n;a[4]=y*f+z*k+B*o;a[5]=y*g+z*m+B*b;a[6]=C*e+E*i+c*n;a[7]=C*f+E*k+c*o;a[8]=C*g+E*m+c*b;return a}};Ok.Am=Ok.multiply;Ok.translate=function(a,b,c){var e=b[0],f=b[1],g=b[2],i=b[3],k=b[4],m=b[5],n=b[6],o=b[7],b=b[8],s=c[0],c=c[1];a[0]=e;a[1]=f;a[2]=g;a[3]=i;a[4]=k;a[5]=m;a[6]=s*e+c*i+n;a[7]=s*f+c*k+o;a[8]=s*g+c*m+b;return a}; Ok.rotate=function(a,b,c){var e=b[0],f=b[1],g=b[2],i=b[3],k=b[4],m=b[5],n=b[6],o=b[7],b=b[8],s=Math.sin(c),c=Math.cos(c);a[0]=c*e+s*i;a[1]=c*f+s*k;a[2]=c*g+s*m;a[3]=c*i-s*e;a[4]=c*k-s*f;a[5]=c*m-s*g;a[6]=n;a[7]=o;a[8]=b;return a};Ok.scale=function(a,b,c){var e=c[0],c=c[1];a[0]=e*b[0];a[1]=e*b[1];a[2]=e*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};Ok.U2=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a}; Ok.JW=function(a,b){var c=b[0],e=b[1],f=b[2],g=b[3],i=c+c,k=e+e,m=f+f,c=c*i,n=e*i,e=e*k,o=f*i,s=f*k,f=f*m,i=g*i,k=g*k,g=g*m;a[0]=1-e-f;a[3]=n-g;a[6]=o+k;a[1]=n+g;a[4]=1-c-f;a[7]=s-i;a[2]=o-k;a[5]=s+i;a[8]=1-c-e;return a}; Ok.J4=function(a,b){var c=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],m=b[6],n=b[7],o=b[8],s=b[9],v=b[10],w=b[11],y=b[12],z=b[13],B=b[14],C=b[15],E=c*k-e*i,F=c*m-f*i,G=c*n-g*i,K=e*m-f*k,O=e*n-g*k,M=f*n-g*m,S=o*z-s*y,ca=o*B-v*y,o=o*C-w*y,Z=s*B-v*z,s=s*C-w*z,v=v*C-w*B,w=E*v-F*s+G*Z+K*o-O*ca+M*S;if(!w)return q;w=1/w;a[0]=(k*v-m*s+n*Z)*w;a[1]=(m*o-i*v-n*ca)*w;a[2]=(i*s-k*o+n*S)*w;a[3]=(f*s-e*v-g*Z)*w;a[4]=(c*v-f*o+g*ca)*w;a[5]=(e*o-c*s-g*S)*w;a[6]=(z*M-B*O+C*K)*w;a[7]=(B*G-y*M-C*F)*w;a[8]=(y*O-z*G+C*E)*w; return a};Ok.Rm=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};Ok.WC=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof exports&&(exports.D4=Ok); var qk={create:function(){var a=new Gk(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},Vh:function(a){var b=new Gk(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9]; a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},tm:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},rO:function(a,b){if(a===b){var c=b[1],e=b[2],f=b[3],g=b[6],i=b[7],k=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=e;a[9]=g;a[11]=b[14];a[12]=f;a[13]=i;a[14]=k}else{a[0]=b[0];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=b[1];a[5]=b[5];a[6]=b[9];a[7]=b[13];a[8]=b[2]; a[9]=b[6];a[10]=b[10];a[11]=b[14];a[12]=b[3];a[13]=b[7];a[14]=b[11];a[15]=b[15]}return a},$o:function(a,b){var c=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],m=b[6],n=b[7],o=b[8],s=b[9],v=b[10],w=b[11],y=b[12],z=b[13],B=b[14],C=b[15],E=c*k-e*i,F=c*m-f*i,G=c*n-g*i,K=e*m-f*k,O=e*n-g*k,M=f*n-g*m,S=o*z-s*y,ca=o*B-v*y,Z=o*C-w*y,Aa=s*B-v*z,ta=s*C-w*z,Ga=v*C-w*B,sa=E*Ga-F*ta+G*Aa+K*Z-O*ca+M*S;if(!sa)return q;sa=1/sa;a[0]=(k*Ga-m*ta+n*Aa)*sa;a[1]=(f*ta-e*Ga-g*Aa)*sa;a[2]=(z*M-B*O+C*K)*sa;a[3]=(v*O-s*M-w*K)*sa; a[4]=(m*Z-i*Ga-n*ca)*sa;a[5]=(c*Ga-f*Z+g*ca)*sa;a[6]=(B*G-y*M-C*F)*sa;a[7]=(o*M-v*G+w*F)*sa;a[8]=(i*ta-k*Z+n*S)*sa;a[9]=(e*Z-c*ta-g*S)*sa;a[10]=(y*O-z*G+C*E)*sa;a[11]=(s*G-o*O-w*E)*sa;a[12]=(k*ca-i*Aa-m*S)*sa;a[13]=(c*Aa-e*ca+f*S)*sa;a[14]=(z*F-y*K-B*E)*sa;a[15]=(o*K-s*F+v*E)*sa;return a},vJ:function(a,b){var c=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],m=b[6],n=b[7],o=b[8],s=b[9],v=b[10],w=b[11],y=b[12],z=b[13],B=b[14],C=b[15];a[0]=k*(v*C-w*B)-s*(m*C-n*B)+z*(m*w-n*v);a[1]=-(e*(v*C-w*B)-s*(f*C-g*B)+ z*(f*w-g*v));a[2]=e*(m*C-n*B)-k*(f*C-g*B)+z*(f*n-g*m);a[3]=-(e*(m*w-n*v)-k*(f*w-g*v)+s*(f*n-g*m));a[4]=-(i*(v*C-w*B)-o*(m*C-n*B)+y*(m*w-n*v));a[5]=c*(v*C-w*B)-o*(f*C-g*B)+y*(f*w-g*v);a[6]=-(c*(m*C-n*B)-i*(f*C-g*B)+y*(f*n-g*m));a[7]=c*(m*w-n*v)-i*(f*w-g*v)+o*(f*n-g*m);a[8]=i*(s*C-w*z)-o*(k*C-n*z)+y*(k*w-n*s);a[9]=-(c*(s*C-w*z)-o*(e*C-g*z)+y*(e*w-g*s));a[10]=c*(k*C-n*z)-i*(e*C-g*z)+y*(e*n-g*k);a[11]=-(c*(k*w-n*s)-i*(e*w-g*s)+o*(e*n-g*k));a[12]=-(i*(s*B-v*z)-o*(k*B-m*z)+y*(k*v-m*s));a[13]=c*(s*B-v*z)- o*(e*B-f*z)+y*(e*v-f*s);a[14]=-(c*(k*B-m*z)-i*(e*B-f*z)+y*(e*m-f*k));a[15]=c*(k*v-m*s)-i*(e*v-f*s)+o*(e*m-f*k);return a},iC:function(a){var b=a[0],c=a[1],e=a[2],f=a[3],g=a[4],i=a[5],k=a[6],m=a[7],n=a[8],o=a[9],s=a[10],v=a[11],w=a[12],y=a[13],z=a[14],a=a[15];return(b*i-c*g)*(s*a-v*z)-(b*k-e*g)*(o*a-v*y)+(b*m-f*g)*(o*z-s*y)+(c*k-e*i)*(n*a-v*w)-(c*m-f*i)*(n*z-s*w)+(e*m-f*k)*(n*y-o*w)},multiply:function(a,b,c){var e=b[0],f=b[1],g=b[2],i=b[3],k=b[4],m=b[5],n=b[6],o=b[7],s=b[8],v=b[9],w=b[10],y=b[11],z= b[12],B=b[13],C=b[14],b=b[15],E=c[0],F=c[1],G=c[2],K=c[3];a[0]=E*e+F*k+G*s+K*z;a[1]=E*f+F*m+G*v+K*B;a[2]=E*g+F*n+G*w+K*C;a[3]=E*i+F*o+G*y+K*b;E=c[4];F=c[5];G=c[6];K=c[7];a[4]=E*e+F*k+G*s+K*z;a[5]=E*f+F*m+G*v+K*B;a[6]=E*g+F*n+G*w+K*C;a[7]=E*i+F*o+G*y+K*b;E=c[8];F=c[9];G=c[10];K=c[11];a[8]=E*e+F*k+G*s+K*z;a[9]=E*f+F*m+G*v+K*B;a[10]=E*g+F*n+G*w+K*C;a[11]=E*i+F*o+G*y+K*b;E=c[12];F=c[13];G=c[14];K=c[15];a[12]=E*e+F*k+G*s+K*z;a[13]=E*f+F*m+G*v+K*B;a[14]=E*g+F*n+G*w+K*C;a[15]=E*i+F*o+G*y+K*b;return a}}; qk.Am=qk.multiply; qk.translate=function(a,b,c){var e=c[0],f=c[1],c=c[2],g,i,k,m,n,o,s,v,w,y,z,B;if(b===a){a[12]=b[0]*e+b[4]*f+b[8]*c+b[12];a[13]=b[1]*e+b[5]*f+b[9]*c+b[13];a[14]=b[2]*e+b[6]*f+b[10]*c+b[14];a[15]=b[3]*e+b[7]*f+b[11]*c+b[15]}else{g=b[0];i=b[1];k=b[2];m=b[3];n=b[4];o=b[5];s=b[6];v=b[7];w=b[8];y=b[9];z=b[10];B=b[11];a[0]=g;a[1]=i;a[2]=k;a[3]=m;a[4]=n;a[5]=o;a[6]=s;a[7]=v;a[8]=w;a[9]=y;a[10]=z;a[11]=B;a[12]=g*e+n*f+w*c+b[12];a[13]=i*e+o*f+y*c+b[13];a[14]=k*e+s*f+z*c+b[14];a[15]=m*e+v*f+B*c+b[15]}return a}; qk.scale=function(a,b,c){var e=c[0],f=c[1],c=c[2];a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*f;a[5]=b[5]*f;a[6]=b[6]*f;a[7]=b[7]*f;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a}; qk.rotate=function(a,b,c,e){var f=e[0],g=e[1],e=e[2],i=Math.sqrt(f*f+g*g+e*e),k,m,n,o,s,v,w,y,z,B,C,E,F,G,K,O,M,S,ca,Z;if(Math.abs(i)<Fk)return q;i=1/i;f=f*i;g=g*i;e=e*i;k=Math.sin(c);m=Math.cos(c);n=1-m;c=b[0];i=b[1];o=b[2];s=b[3];v=b[4];w=b[5];y=b[6];z=b[7];B=b[8];C=b[9];E=b[10];F=b[11];G=f*f*n+m;K=g*f*n+e*k;O=e*f*n-g*k;M=f*g*n-e*k;S=g*g*n+m;ca=e*g*n+f*k;Z=f*e*n+g*k;f=g*e*n-f*k;g=e*e*n+m;a[0]=c*G+v*K+B*O;a[1]=i*G+w*K+C*O;a[2]=o*G+y*K+E*O;a[3]=s*G+z*K+F*O;a[4]=c*M+v*S+B*ca;a[5]=i*M+w*S+C*ca;a[6]= o*M+y*S+E*ca;a[7]=s*M+z*S+F*ca;a[8]=c*Z+v*f+B*g;a[9]=i*Z+w*f+C*g;a[10]=o*Z+y*f+E*g;a[11]=s*Z+z*f+F*g;if(b!==a){a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}return a};qk.tN=function(a,b,c){var e=Math.sin(c),c=Math.cos(c),f=b[4],g=b[5],i=b[6],k=b[7],m=b[8],n=b[9],o=b[10],s=b[11];if(b!==a){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[4]=f*c+m*e;a[5]=g*c+n*e;a[6]=i*c+o*e;a[7]=k*c+s*e;a[8]=m*c-f*e;a[9]=n*c-g*e;a[10]=o*c-i*e;a[11]=s*c-k*e;return a}; qk.uN=function(a,b,c){var e=Math.sin(c),c=Math.cos(c),f=b[0],g=b[1],i=b[2],k=b[3],m=b[8],n=b[9],o=b[10],s=b[11];if(b!==a){a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[0]=f*c-m*e;a[1]=g*c-n*e;a[2]=i*c-o*e;a[3]=k*c-s*e;a[8]=f*e+m*c;a[9]=g*e+n*c;a[10]=i*e+o*c;a[11]=k*e+s*c;return a}; qk.vN=function(a,b,c){var e=Math.sin(c),c=Math.cos(c),f=b[0],g=b[1],i=b[2],k=b[3],m=b[4],n=b[5],o=b[6],s=b[7];if(b!==a){a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[0]=f*c+m*e;a[1]=g*c+n*e;a[2]=i*c+o*e;a[3]=k*c+s*e;a[4]=m*c-f*e;a[5]=n*c-g*e;a[6]=o*c-i*e;a[7]=s*c-k*e;return a}; qk.W2=function(a,b,c){var e=b[0],f=b[1],g=b[2],i=b[3],k=e+e,m=f+f,n=g+g,b=e*k,o=e*m,e=e*n,s=f*m,f=f*n,g=g*n,k=i*k,m=i*m,i=i*n;a[0]=1-(s+g);a[1]=o+i;a[2]=e-m;a[3]=0;a[4]=o-i;a[5]=1-(b+g);a[6]=f+k;a[7]=0;a[8]=e+m;a[9]=f-k;a[10]=1-(b+s);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a}; qk.JW=function(a,b){var c=b[0],e=b[1],f=b[2],g=b[3],i=c+c,k=e+e,m=f+f,c=c*i,n=e*i,e=e*k,o=f*i,s=f*k,f=f*m,i=g*i,k=g*k,g=g*m;a[0]=1-e-f;a[1]=n+g;a[2]=o-k;a[3]=0;a[4]=n-g;a[5]=1-c-f;a[6]=s+i;a[7]=0;a[8]=o+k;a[9]=s-i;a[10]=1-c-e;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};qk.Y2=function(a,b,c,e,f,g,i){var k=1/(c-b),m=1/(f-e),n=1/(g-i);a[0]=g*2*k;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=g*2*m;a[6]=0;a[7]=0;a[8]=(c+b)*k;a[9]=(f+e)*m;a[10]=(i+g)*n;a[11]=-1;a[12]=0;a[13]=0;a[14]=i*g*2*n;a[15]=0;return a}; qk.zZ=function(a,b,c){var b=1/Math.tan(b/2),e=1/-999.99;a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1000.01*e;a[11]=-1;a[12]=0;a[13]=0;a[14]=20*e;a[15]=0};qk.T4=function(a,b,c,e,f,g,i){var k=1/(b-c),m=1/(e-f),n=1/(g-i);a[0]=-2*k;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*m;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*n;a[11]=0;a[12]=(b+c)*k;a[13]=(f+e)*m;a[14]=(i+g)*n;a[15]=1;return a}; qk.w4=function(a,b,c,e){var f,g,i,k,m,n,o,s,v=b[0],w=b[1],b=b[2];i=e[0];k=e[1];g=e[2];o=c[0];e=c[1];f=c[2];if(Math.abs(v-o)<Fk&&Math.abs(w-e)<Fk&&Math.abs(b-f)<Fk)return qk.tm(a);c=v-o;e=w-e;o=b-f;s=1/Math.sqrt(c*c+e*e+o*o);c=c*s;e=e*s;o=o*s;f=k*o-g*e;g=g*c-i*o;i=i*e-k*c;if(s=Math.sqrt(f*f+g*g+i*i)){s=1/s;f=f*s;g=g*s;i=i*s}else i=g=f=0;k=e*i-o*g;m=o*f-c*i;n=c*g-e*f;if(s=Math.sqrt(k*k+m*m+n*n)){s=1/s;k=k*s;m=m*s;n=n*s}else n=m=k=0;a[0]=f;a[1]=k;a[2]=c;a[3]=0;a[4]=g;a[5]=m;a[6]=e;a[7]=0;a[8]=i;a[9]= n;a[10]=o;a[11]=0;a[12]=-(f*v+g*w+i*b);a[13]=-(k*v+m*w+n*b);a[14]=-(c*v+e*w+o*b);a[15]=1;return a};qk.Rm=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"}; qk.WC=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof exports&&(exports.E4=qk);var Pk={create:function(){var a=new Gk(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}}; Pk.q5=function(){var a=Lk.create(),b=Lk.ug(1,0,0),c=Lk.ug(0,1,0);return function(e,f,g){var i=Lk.cs(f,g);if(i<-0.999999){Lk.ww(a,b,f);Lk.length(a)<1.0E-6&&Lk.ww(a,c,f);Lk.normalize(a,a);Pk.d_(e,a);return e}if(i>0.999999){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}Lk.ww(a,f,g);e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=1+i;return Pk.normalize(e,e)}}(); Pk.u5=function(){var a=Ok.create();return function(b,c,e,f){a[0]=e[0];a[3]=e[1];a[6]=e[2];a[1]=f[0];a[4]=f[1];a[7]=f[2];a[2]=-c[0];a[5]=-c[1];a[8]=-c[2];return Pk.normalize(b,Pk.IW(b,a))}}();Pk.Vh=pk.Vh;Pk.ug=pk.ug;Pk.copy=pk.copy;Pk.set=pk.set;Pk.tm=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};Pk.d_=function(a,b){var c=Math.PI,c=c*0.5,e=Math.sin(c);a[0]=e*b[0];a[1]=e*b[1];a[2]=e*b[2];a[3]=Math.cos(c)};Pk.add=pk.add; Pk.multiply=function(a,b,c){var e=b[0],f=b[1],g=b[2],b=b[3],i=c[0],k=c[1],m=c[2],c=c[3];a[0]=e*c+b*i+f*m-g*k;a[1]=f*c+b*k+g*i-e*m;a[2]=g*c+b*m+e*k-f*i;a[3]=b*c-e*i-f*k-g*m;return a};Pk.Am=Pk.multiply;Pk.scale=pk.scale;Pk.tN=function(a,b,c){var c=c*0.5,e=b[0],f=b[1],g=b[2],b=b[3],i=Math.sin(c),c=Math.cos(c);a[0]=e*c+b*i;a[1]=f*c+g*i;a[2]=g*c-f*i;a[3]=b*c-e*i;return a}; Pk.uN=function(a,b,c){var c=c*0.5,e=b[0],f=b[1],g=b[2],b=b[3],i=Math.sin(c),c=Math.cos(c);a[0]=e*c-g*i;a[1]=f*c+b*i;a[2]=g*c+e*i;a[3]=b*c-f*i;return a};Pk.vN=function(a,b,c){var c=c*0.5,e=b[0],f=b[1],g=b[2],b=b[3],i=Math.sin(c),c=Math.cos(c);a[0]=e*c+f*i;a[1]=f*c-e*i;a[2]=g*c+b*i;a[3]=b*c-g*i;return a};Pk.n2=function(a,b){var c=b[0],e=b[1],f=b[2];a[0]=c;a[1]=e;a[2]=f;a[3]=-Math.sqrt(Math.abs(1-c*c-e*e-f*f));return a};Pk.cs=pk.cs;Pk.yx=pk.yx; Pk.F5=function(a,b,c,e){var f=b[0],g=b[1],i=b[2],b=b[3],k=c[0],m=c[1],n=c[2],c=c[3],o,s,v;s=f*k+g*m+i*n+b*c;if(s<0){s=-s;k=-k;m=-m;n=-n;c=-c}if(1-s>1.0E-6){o=Math.acos(s);v=Math.sin(o);s=Math.sin((1-e)*o)/v;e=Math.sin(e*o)/v}else s=1-e;a[0]=s*f+e*k;a[1]=s*g+e*m;a[2]=s*i+e*n;a[3]=s*b+e*c;return a};Pk.$o=function(a,b){var c=b[0],e=b[1],f=b[2],g=b[3],i=c*c+e*e+f*f+g*g,i=i?1/i:0;a[0]=-c*i;a[1]=-e*i;a[2]=-f*i;a[3]=g*i;return a};Pk.u2=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a}; Pk.length=pk.length;Pk.hE=Pk.length;Pk.Qk=pk.Qk;Pk.jF=Pk.Qk;Pk.normalize=pk.normalize;Pk.IW=function(a,b){var c=b[0]+b[4]+b[8];if(c>0){c=Math.sqrt(c+1);a[3]=0.5*c;c=0.5/c;a[0]=(b[7]-b[5])*c;a[1]=(b[2]-b[6])*c;a[2]=(b[3]-b[1])*c}else{var e=0;b[4]>b[0]&&(e=1);b[8]>b[e*3+e]&&(e=2);var f=(e+1)%3,g=(e+2)%3,c=Math.sqrt(b[e*3+e]-b[f*3+f]-b[g*3+g]+1);a[e]=0.5*c;c=0.5/c;a[3]=(b[g*3+f]-b[f*3+g])*c;a[f]=(b[f*3+e]+b[e*3+f])*c;a[g]=(b[g*3+e]+b[e*3+g])*c}return a}; Pk.Rm=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof exports&&(exports.k5=Pk);function Qk(a,b){this.Jf=a;this.fq=b||2;this.dA=a-this.fq;this.uc=[];this.Mg=[];this.QD()}A.extend(Qk.prototype,{QD:function(){var a,b;this.uc.push(0,-20,0);for(ph=0;360>ph;ph+=6)a=Math.cos(U(ph))*this.Jf,b=Math.sin(U(ph))*this.Jf,this.uc.push(a,-20,b)},OD:function(){for(var a=(this.uc.length-3)/3,b=1;b<a;b++)this.Mg.push(0,b,b+1);this.Mg.push(0,b,1)},kD:function(){0==this.Mg.length&&this.OD();return this.Mg}});function Rk(a,b){this.Jf=a;this.fq=b||2;this.dA=a-this.fq;this.uc=[];this.Mg=[];this.QD()} A.extend(Rk.prototype,{QD:function(){for(var a,b,c=0;360>c;c+=6)a=Math.cos(U(c))*this.dA,b=Math.sin(U(c))*this.dA,this.uc.push(a,-20,b);for(c=0;360>c;c+=6)a=Math.cos(U(c))*this.Jf,b=Math.sin(U(c))*this.Jf,this.uc.push(a,-20,b)},OD:function(){var a=this.uc.length/3/2;for(ph=0;ph<a-1;ph++)this.Mg.push(ph,ph+a+1,ph+a),this.Mg.push(ph,ph+1,ph+a+1);this.Mg.push(ph,a,ph+a);this.Mg.push(ph,0,a)},kD:function(){0==this.Mg.length&&this.OD();return this.Mg}});function Sk(a){this.Jf=a;this.Td=Math.pow(2,4);this.kr=this.Td/2;this.uc=[];this.Az=[];a=360/this.Td;this.gJ=Math.cos(U(3*a))*this.Jf;this.hJ=Math.cos(U(2*a))*this.Jf;this.iJ=Math.cos(U(1*a))*this.Jf;this.pY()} A.extend(Sk.prototype,{pY:function(){if(!(0<this.uc.length))for(var a=this.Jf,b=[],c=64/this.Td,e=64/c,f=[],g=0,i=0,k,m=0;33>m;m++)for(var n=Math.cos(U(5.625*m-90))*a,n=Math.round(100*n)/100,o=Math.sin(U(5.625*m-90))*a,o=Math.round(100*o)/100,g=Math.floor(m/c),s=0;64>s;s++){var v=Math.cos(U(5.625*s))*n,w=Math.sin(U(5.625*s))*n,v=Math.round(100*v)/100,w=Math.round(100*w)/100;b.push(v,o,w);i=Math.floor(s/c);k=i+g*e;g<this.kr&&(this.uc[k]||(this.uc[k]=[]),this.uc[k].push(v,o,w));if(0<g&&0==m%c){var y= i+(g-1)*e;this.uc[y].push(v,o,w);0<s&&0==s%c&&this.uc[y-1]&&this.uc[y-1].push(v,o,w);63==s&&this.uc[y].push(f[0],f[1],f[2])}0==i&&0==s&&(f=[v,o,w]);0<s&&0==s%c&&this.uc[k-1]&&this.uc[k-1].push(v,o,w);g<this.kr&&63==s&&this.uc[k].push(f[0],f[1],f[2])}},oY:function(){for(var a=64/this.Td,b=a+1,c=0;c<a;c++)for(var e=0;e<a;e++){var f=c*b,g=f+e+1;this.Az.push(f+e,g,f+e+1+b);g=f+e+1+b;this.Az.push(f+e,g,f+b+e)}return this.Az},NW:function(a,b,c){var e=this.uc[Math.round(this.uc.length/2)];if(e){for(var f= [],g=Math.pow(2,5-a),b=b%g,c=c%g,i=64/this.Td,k=1/i,m=1/(32/this.kr),n=0;n<e.length/3;n++){var o=n%(i+1)*k,s=Math.floor(n/(i+1))*m,o=o/g+1*b/g,s=s/g+1*c/g;1===a&&(s*=2);f.push(o,s)}return f}},$W:function(a){var b=0,c=0,c=a[0],b=a[1],e=a[2],a=Math.round(180*Math.atan(Math.abs(e)/Math.abs(c))/Math.PI);0<c?0>e&&(a=360-a):a=0<e?180-a:180+a;c=b>this.iJ?7:b>this.hJ?6:b>this.gJ?5:0<b?4:b>-this.gJ?3:b>-this.hJ?2:b>-this.iJ?1:0;b=Math.floor(a/22.5);return[b,c,b+c*(64/(64/this.Td))]}});function ik(a){this.W=a;this.ne=this.nb=this.Rb=this.Rh=q;var b=this;this.xr=new sk(6,{vo:function(a){for(var e=0;e<a.length;e++)if(a[e])for(var f=0;f<a[e].length;f++)a[e][f]&&(b.nb.deleteTexture(a[e][f].uy),a[e][f].bs=t)}});this.WI=new sk(32,{vo:function(a){a&&(a.Cz=p,a.src="")}});this.Wz=new tk;this.Td=16;this.kr=8;this.Jf=500;this.Pj=this.Vi=0;this.Hf=[qk.create(),qk.create()];this.Kh=qk.create();this.AA=[qk.create(),qk.create()];this.Uq=qk.create();this.yA=[];this.Nl=this.$n=this.Jv=q;this.sr= {};this.lR();this.lB=0;this.Mu=[q,q];this.Xz=[q,q];this.mg=[];this.Hc=1.5<(window.devicePixelRatio||1)?2:1;this.Li()} A.extend(ik.prototype,{lR:function(){this.ml=[];for(var a=2;5>=a;a++)this.ml[a]={cols:Math.pow(2,a-1),rows:Math.pow(2,a-1)/2};this.ml[1]={cols:1,rows:1}},Li:function(){this.mz();this.nb=this.Rb.getContext("webgl",{alpha:t});this.Sv=Dk.get(this.nb,this.W.ca);this.aA();this.OT();this.Fz();this.Gz();this.fT();this.Sv.ND()},mz:function(){var a=this.Rb=L("canvas"),b=this.Rb.style,c=this.W.R,e=c.clientWidth,c=c.clientHeight;b.width=e+"px";b.height=c+"px";this.Vi=a.width=e*this.Hc;this.Pj=a.height=c*this.Hc; this.W.Ph.appendChild(this.Rb)},OT:function(){var a=this.nb,b=this.Rb;a.clearColor(0,0,0,1);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.depthMask(p);a.viewport(0,0,b.width,b.height)},Kk:function(){var a=this.W.R,b=a.clientWidth,a=a.clientHeight;this.Rb.style.width=b+"px";this.Rb.style.height=a+"px";this.Vi=this.Rb.width=b*this.Hc;this.Pj=this.Rb.height=a*this.Hc;this.yq=q;b=this.Rb;this.nb.viewport(0,0,b.width,b.height)},aA:function(){var a=this.nb,b= this.ne=a.createProgram(),c=this.sl("attribute vec3 aVertexPosition;\\nattribute vec2 aVertexTextureCoordBack;\\nattribute vec2 aVertexTextureCoord;\\nvarying mediump vec2 vTextureCoordBack;\\nvarying mediump vec2 vTextureCoord;\\nuniform mat4 uMVMatrix;\\nuniform mat4 uPMatrix;\\nvoid main(void) {\\n    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\\n    vTextureCoordBack = aVertexTextureCoordBack;\\n    vTextureCoord = aVertexTextureCoord;\\n}",a.VERTEX_SHADER),e=this.sl("precision mediump float;\\nvarying vec2 vTextureCoordBack;\\nvarying vec2 vTextureCoord;\\nuniform sampler2D uSamplerBack;\\nuniform sampler2D uSampler;\\nuniform bool uDrawThumb;\\nuniform bool uDrawBack;\\nuniform float uAlpha;\\nvoid main(void) {\\n    if (uDrawThumb) {\\n        gl_FragColor = texture2D(uSamplerBack, vTextureCoordBack);\\n        return;\\n    }\\n    if (uAlpha == 1.0) {\\n        gl_FragColor = texture2D(uSampler, vTextureCoord);\\n        return;\\n    }\\n    if (uDrawBack) {\\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha + texture2D(uSamplerBack, vTextureCoordBack) * (1.0 - uAlpha);\\n    } else {\\n        vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\\n        gl_FragColor =  vec4(textureColor.rgb, textureColor.a * uAlpha);\\n    }\\n}", a.FRAGMENT_SHADER);a.attachShader(b,c);a.attachShader(b,e);a.bindAttribLocation(b,0,"aVertexPosition");a.linkProgram(b)},sl:function(a,b){var c=this.nb,e=c.createShader(b);c.shaderSource(e,a);c.compileShader(e);return e},fT:function(){var a=new Sk(this.Jf),b=a.oY();this.sr={VN:a,AW:b,zW:a.uc}},setData:function(a){a!==q&&(this.Dl=this.ha?this.ha.id:q,this.LA=this.ha||q);(this.ha=a)&&this.xr.setData(a.id,[])},za:function(a,b){if(this.ha){this.Ka=a;this.bf=b;var c=this.Rb;this.Rh||(this.Rh=this.W.ja()); if(!this.yq){var e=180/Math.pow(2,this.Rh);this.sB=c.width/c.height;this.yq=1<this.sB?2*Math.atan(Math.tan(U(e/2)))/this.sB:U(180/Math.pow(2,this.Rh));qk.zZ(this.Kh,this.yq,this.sB);qk.$o(this.Uq,this.Kh)}this.Zy(0);c=this.Hz(0);this.Mu[0]=c[0];this.Xz[0]=c[1];this.wS();this.tr()}},Zy:function(a){qk.tm(this.Hf[a]);qk.rotate(this.Hf[a],this.Hf[a],U(this.Ka.pitch),[-1,0,0]);var b=this.ha.tiles.dirNorth;1==a&&this.LA&&(b=this.LA.tiles.dirNorth);qk.rotate(this.Hf[a],this.Hf[a],U(b+this.Ka.heading+90), [0,1,0]);qk.$o(this.AA[a],this.Hf[a])},Nj:function(a,b,c){var e=this.Vi,f=this.Pj,g=pk.create(),i=this.Uq,c=this.AA[c],a=pk.ug(2*a/e-1,1-2*b/f,-1,1);qk.multiply(g,i,a);qk.multiply(g,c,g);b=this.Jf;i=200*g[0];a=200*g[1];g=200*g[2];b=Math.sqrt(-(-b*b)/(i*i+a*a+g*g));return this.sr.VN.$W([i*b,a*b,g*b])},FH:function(a,b,c,e){var f=this.Pj,b=pk.ug(a,b,c,1),a=pk.create();qk.multiply(a,this.Hf[e],b);b=pk.ug(a[0],a[1],a[2],a[3]);qk.multiply(a,this.Kh,b);if(0!==a[3])return e=(1-Lk.ug(a[0]/a[3],a[1]/a[3],a[2]/ a[3])[1])*f/2,0<a[3]&&0<e&&e<f?p:t},Qc:function(a,b,c){var c=c||{},e=c.hp||t,f=c.LZ||q;this.Rn=this.bf;this.bf=b;this.yq=q;var g=this,i=this.Rh,k=a-i;g.Hq&&(g.Hq.stop(),g.Hq=q);e?(g.Rh=a,g.lU=t,g.za(g.Ka,b)):g.Hq=new wb({duration:600,Ic:60,ac:xb.xK,za:function(a){if(a!=0){g.yq=q;g.Rh=i+k*a;a<0.5?g.za(g.Ka,g.Rn):g.za(g.Ka,b);f&&f(g.Rh)}},finish:function(){g.Hq=q;g.Rh=a;g.lU=t;g.W.dispatchEvent(new P("onzoom_changed"))},it:function(){g.W.dispatchEvent(new P("onzoom_changed"));g.Hq=q}})},wS:function(){var a= this;this.mI(0,0,1,function(){a.Tg||a.QH()})},QH:function(){for(var a=this.Xz[0],b=a[0],c=a[1],e=a[3],a=a[2];a<=e;a++){var f=b,g=c;"number"===typeof this.Yz&&(a>=this.Yz&&a<=this.GH)&&(f=0,g=this.ml[this.bf].cols-1);for(;f<=g;f++)this.mI(f,a)}},mI:function(a,b,c,e){var c=c||this.bf,f=this.ml[c].cols,g=this.ml[c].rows,i=this,a=i.OA(a,c);0>b&&(a=i.OA(f-1-a,c),b=0);b>g-1&&(a=i.OA(f-1-a,c),b=g-1);var k=a+b*f,m=i.xr.getData(i.ha.id);m[c]||(m[c]=[]);m[c][k]||(m[c][k]={});var n=m[c][k];n.loaded?(i.KI(c)&& i.RI(),e&&e()):(n.index=k,n.loaded=t,n.mZ=i.ha.id,i.vS(a,b,c,function(a){if(n.mZ==i.ha.id){n.loaded=p;var b=m[c][k];if(!b.bs){i.NT(b,a,c);if(c>1)b.Ql={duration:300,startTime:Date.now(),YB:0,Bo:1};b.bs=p}i.KI(c)&&i.RI();e&&e();i.tr()}}))},KI:function(a){return 1===a&&this.Dl&&this.W.bJ?p:t},KN:ba("HS"),OA:function(a,b){for(var c=a,e=this.ml[b||this.bf].cols;0>c;)c+=e;return c%e},zf:function(){this.lB--;0===this.lB&&this.W.dispatchEvent(new P("ontilesloaded"))},tr:function(){this.Au&&(clearTimeout(this.Au), this.Au=q);var a=this;this.Au=setTimeout(function(){cancelAnimationFrame(a.rv);a.rv=q;a.Au=q},300);this.rv||this.qv()},qv:function(){var a=this;a.rv=requestAnimationFrame(function(){a.qv()});var b=this.ne;this.nb.useProgram(b);var c=this.Sv;c.Eo(b.Xm);c.Eo(b.GO);c.Eo(b.bu);c.oC();b=t;this.Tg?this.kT():b=this.TA(0);if(b&&!this.Tg)for(b=0;b<this.mg.length;b++)this.mg[b].qv(this.Kh,this.Hf[0],this.Uq,this.AA[0])},TA:function(a,b){if(!this.ha)return t;var c=this.Mu[a];if(!c)return t;var e=0==a?this.ha.id: this.Dl;if(!e)return t;b&&qk.translate(this.Hf[a],this.yA[a],b);var f=c[0],g=c[1],i=c[2],c=c[3];this.Tg&&0==a&&(f-=2,g+=2,i-=2,c+=2,i=0>i?0:i);e=this.xr.getData(e);if(!e)return t;for(;i<=c;i++){var k=f,m=g;"number"===typeof this.gk&&(i>=this.gk&&i<=this.Ol)&&(k=0,m=this.Td-1);for(;k<=m;k++){for(var n=k;0>n;)n+=this.Td;var n=n%this.Td,o=this.jl(n,i)[2],s=this.jl(n,i,this.Rn)[2],v=this.jl(n,i,1)[2],w=q,y=q,z=1;e[this.bf]&&(e[this.bf][o]&&e[this.bf][o].bs)&&(w=o);e[this.Rn]&&e[this.Rn][s]&&e[this.Rn][s].bs? (y=s,z=this.Rn):e[1][v]&&e[1][v].bs&&(y=v);if(w===q&&y===q)return t;o=this.nb;s=this.ne;v=this.bf;this.Tg&&1==a?(o.uniform1i(s.qK,t),w===q&&(w=y,v=1),y=q):o.uniform1i(s.qK,p);this.pS(w,v,y,z,a);this.MT(n,i,v,z);this.ZA(a);this.XQ()}}return p},jl:function(a,b,c){var c=c||this.bf,e=Math.pow(2,5-c),a=Math.floor(a/e),b=Math.floor(b/e),b=this.ml[c].rows-b-1;return[a,b,a+b*this.Td/e]},NT:function(a,b,c){if(a){var e=this.nb;1===c?e.activeTexture(e.TEXTURE0):e.activeTexture(e.TEXTURE1);a.uy=e.createTexture(); e.bindTexture(e.TEXTURE_2D,a.uy);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,p);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,b);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)}},pS:function(a,b,c,e,f){var g=0==f?this.ha.id:this.Dl;if(g){var i=this.xr.getData(g),g=this.nb,k=this.ne;a===q?g.uniform1i(k.vK, p):g.uniform1i(k.vK,t);var m=q;i[e]&&i[e][c]&&(g.activeTexture(g.TEXTURE0),m=i[e][c].uy,g.bindTexture(g.TEXTURE_2D,m),g.uniform1i(k.UZ,0));if("number"===typeof a){g.activeTexture(g.TEXTURE1);g.bindTexture(g.TEXTURE_2D,i[b][a].uy);g.uniform1i(k.VZ,1);a=i[b][a];"number"!=typeof a.Bo&&(a.Bo=1);if(1==f&&(!a.Ql||0!=a.Ql.Bo))a.Ql={duration:400,startTime:this.Cv,YB:1,Bo:0},a.Bo=0;a.Ql?(f=a.Ql,b=(Date.now()-f.startTime)/f.duration,0==f.YB?(f=b,1<f&&(f=1,a.Ql=q)):(f=f.YB*(1-b),0>f&&(f=0,a.Ql=q)),g.uniform1f(k.alpha, f)):g.uniform1f(k.alpha,a.Bo)}}},MT:function(a,b,c,e){var f=this.ZR(a,b),g=this.sr.AW,c=this.yH(a,b,c),a=this.yH(a,b,e),b=this.nb;this.Jv||(this.Jv=b.createBuffer());b.bindBuffer(b.ARRAY_BUFFER,this.Jv);b.bufferData(b.ARRAY_BUFFER,new Float32Array(f),b.STATIC_DRAW);this.$n||(this.$n=b.createBuffer(),this.$n.DF=g.length,b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.$n),b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(g),b.STATIC_DRAW));this.pB||(this.pB=b.createBuffer());b.bindBuffer(b.ARRAY_BUFFER, this.pB);b.bufferData(b.ARRAY_BUFFER,new Float32Array(a),b.STATIC_DRAW);c&&(this.Nl||(this.Nl=b.createBuffer()),b.bindBuffer(b.ARRAY_BUFFER,this.Nl),b.bufferData(b.ARRAY_BUFFER,new Float32Array(c),b.STATIC_DRAW))},XQ:function(){var a=this.nb,b=this.ne;a.bindBuffer(a.ARRAY_BUFFER,this.Jv);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.$n);a.vertexAttribPointer(b.Xm,3,a.FLOAT,t,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.pB);a.vertexAttribPointer(b.GO,2,a.FLOAT,t,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.Nl);a.vertexAttribPointer(b.bu, 2,a.FLOAT,t,0,0);a.drawElements(a.TRIANGLES,this.$n.DF,a.UNSIGNED_SHORT,0)},ZR:function(a,b){return this.sr.zW[a+b*(64/(64/this.Td))]},yH:function(a,b,c){return this.sr.VN.NW(c||this.bf,a,b)},Fz:function(){var a=this.ne,b=this.nb;a.jt=b.getUniformLocation(a,"uPMatrix");a.ft=b.getUniformLocation(a,"uMVMatrix");a.vK=b.getUniformLocation(a,"uDrawThumb");a.qK=b.getUniformLocation(a,"uDrawBack");a.alpha=b.getUniformLocation(a,"uAlpha");a.UZ=b.getUniformLocation(a,"uSamplerBack");a.VZ=b.getUniformLocation(a, "uSampler")},Gz:function(){var a=this.ne,b=this.nb;a.Xm=b.getAttribLocation(a,"aVertexPosition");a.GO=b.getAttribLocation(a,"aVertexTextureCoordBack");a.bu=b.getAttribLocation(a,"aVertexTextureCoord")},ZA:function(a){var b=this.ne,c=this.nb;c.uniformMatrix4fv(b.jt,t,this.Kh);c.uniformMatrix4fv(b.ft,t,this.Hf[a])},iq:function(a,b,c,e){return a+"_"+b+"_"+c+"_"+e},vS:function(a,b,c,e){var f=this.iq(this.ha.id,a,b,c),g=this.WI.getData(f);this.lB++;if(g)g.Pq&&(e(g),this.zf());else{g=this.Wz.Tw();g.crossOrigin= "anonymous";g.Pq=t;var i=this;g.onload=function(){-1!=this.src.indexOf("pos=0_0&z=1")&&i.W.dispatchEvent(new P("onthumbnail_complete"));e(this);i.zf();this.Pq=p};g.src=this.ha.tiles.getTilesUrl(this.ha.id,new R(a,b),c);this.WI.setData(f,g)}},Hz:function(a){var b=this.Vi,c=this.Pj,e,f,g,i,k,m=this.Nj(0,0,a);e=m[0];i=m[1];m=this.Nj(b/2,0,a);m[1]>i&&(i=m[1]);m=this.Nj(b,0,a);f=m[0];f<e&&(f+=this.Td);k=m[1];m=this.Nj(0,c/2,a);m[0]>f&&(m[0]-=this.Td);m[0]<e&&(e=m[0]);m=this.Nj(b,c/2,a);m[0]<e&&(m[0]+= this.Td);m[0]>f&&(f=m[0]);m=this.Nj(0,c,a);m[0]>f&&(m[0]-=this.Td);m[0]<e&&(e=m[0]);g=m[1];m=this.Nj(b/2,c,a);m[1]<g&&(g=m[1]);m=this.Nj(b,c,a);m[0]<e&&(m[0]+=this.Td);m[0]>f&&(f=m[0]);b=m[1];this.FH(0,100,0,a)?(this.Ol=this.kr-1,this.gk=k):this.FH(0,-100,0,a)?(this.gk=0,this.Ol=b):this.GH=this.Yz=this.Ol=this.gk=q;this.Ol!=q&&i<this.Ol&&(i=this.Ol);this.gk!=q&&g>this.gk&&(g=this.gk);b=this.jl(e,i);c=this.jl(f,g);a=b[0];k=c[0];b=b[1];c=c[1];this.Yz=this.jl(0,this.gk)[1];this.GH=this.jl(0,this.Ol)[1]; return[[e,f,g,i],[a,k,b,c]]},pU:function(a){this.mg.push(a)},RI:function(){if(!this.Tg&&(this.Zy(1),this.yA[0]=qk.Vh(this.Hf[0]),this.yA[1]=qk.Vh(this.Hf[1]),this.Mu[1]=this.Hz(1)[0],this.Tg=p,this.tz=160,this.uz=120,"number"==typeof this.W.TG)){var a=Math.pow(this.W.TG,0.25);this.tz*=a;this.uz*=a}},fI:function(){this.Tg=t;this.Cv=this.Dl=q;this.Zy(0);var a=this.Hz(0);this.Mu[0]=a[0];this.Xz[0]=a[1];this.QH();this.tr()},kT:function(){this.Cv||(this.Cv=Date.now());this.tr();this.HQ=Date.now();var a= this.HQ-this.Cv;if(400<a)this.fI();else{var a=a/400,a=-a*(a-2),b=this.LA.links[this.HS];if(b){var c=b.dir+this.ha.tiles.dirNorth;360<c&&(c%=360);var e=this.tz*(1-a),f=Math.cos(U(c))*e,c=Math.sin(U(c))*e;try{this.TA(0,[f,0,c])}catch(g){}e=this.uz*a;f=Math.cos(U(b.FE))*e;c=Math.sin(U(b.FE))*e;try{this.TA(1,[-f,0,-c])}catch(i){}}else this.fI()}},hC:function(){cancelAnimationFrame(this.rv);this.xr.clear()}});var Tk,Uk;I()?(Tk={iG:"touchstart",gG:"touchmove",ZF:"touchend",jP:"touchcancel",yP:"gesturechange",U0:"DOMMouseScroll"},Uk=function(a){a=0<a.touches.length?a.touches[0]:a.changedTouches[0];return{x:a.offsetX,y:a.offsetY}}):(Tk={iG:"mousedown",gG:"mousemove",ZF:"mouseup",jP:"mouseout",yP:"mousewheel"},Uk=function(a){return{x:a.offsetX,y:a.offsetY}}); function jk(a,b){this.W=a;this.Rb=b;this.Vi=b.width;this.Pj=b.height;this.nb=b.getContext("webgl",{alpha:t});this.Sv=Dk.get(this.nb,this.W.ca);this.ha=this.ne=q;this.Ua=t;this.Li();this.hi=Wa();this.Jj=this.Pi=p;this.tn=[0,-20,0];this.Hc=(window.devicePixelRatio||1)>1.5?2:1;this.jn=this.kn=this.hn=q;this.Sd={};a.oA=this;this.Xn=a.mg.Bd;this.Vd=new T;this.Dr=q} var Vk=[10,-20,30,10,-20,10,-10,-20,10,-10,-20,30],Wk=[0,0,0,1,1,1,1,0],Xk=[2.2,-20,22.3,2.2,-20,13.7,-2.2,-20,13.7,-2.2,-20,22.3],Yk=[0,0,0,0.5,0.25,0.5,0.25,0]; A.extend(jk.prototype,{Li:function(){this.IG=new Qk(8.5);this.wI=new Rk(10,1.5);this.yS();this.aA();this.kS();this.ga();this.Fz();this.Gz()},yS:function(){var a=new Image,b=this;a.crossOrigin="anonymous";a.onload=function(){this.Pq=p;b.hn=b.nb.createTexture();b.bA(b.hn,this)};a.src="//webmap0.bdimg.com/wolfman/static/pano/images/webgl/link-arrow-shadow_0e51d57.png";a=new Image;a.crossOrigin="anonymous";a.onload=function(){this.Pq=p;b.kn=b.nb.createTexture();b.bA(b.kn,this)};a.src="//webmap0.bdimg.com/wolfman/static/pano/images/webgl/link-arrow_cac0d01.png"; a=new Image;a.crossOrigin="anonymous";a.onload=function(){this.Pq=p;b.jn=b.nb.createTexture();b.bA(b.jn,this)};a.src="//webmap0.bdimg.com/wolfman/static/pano/images/webgl/dir-texture_acee461.png"},aA:function(){var a=this.nb,b=this.ne=a.createProgram(),c=this.sl("attribute vec3 aVertexPosition;\\nuniform mat4 uMVMatrix;\\nuniform mat4 uPMatrix;\\nvoid main(void) {\\n    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\\n}",a.VERTEX_SHADER),e=this.sl("precision mediump float;\\nuniform float uColor;\\nuniform float uAlpha;\\nvoid main(void) {\\n    gl_FragColor = vec4(uColor, uColor, uColor, 1.0) * uAlpha;\\n}", a.FRAGMENT_SHADER);a.attachShader(b,c);a.attachShader(b,e);a.linkProgram(b);a.useProgram(b)},kS:function(){var a=this.nb,b=this.Vu=a.createProgram(),c=this.sl("attribute vec3 aVertexPosition;\\nattribute vec2 aVertexTextureCoord;\\nvarying highp vec2 vTextureCoord;\\nuniform mat4 uMVMatrix;\\nuniform mat4 uPMatrix;\\nvoid main(void) {\\n    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\\n    vTextureCoord = aVertexTextureCoord;\\n}",a.VERTEX_SHADER),e=this.sl("precision mediump float;\\nuniform sampler2D uSampler;\\nvarying highp vec2 vTextureCoord;\\nvoid main(void) {\\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\\n}", a.FRAGMENT_SHADER);a.attachShader(b,c);a.attachShader(b,e);a.linkProgram(b);a.useProgram(b)},sl:function(a,b){var c=this.nb,e=c.createShader(b);c.shaderSource(e,a);c.compileShader(e);return e},bA:function(a,b){var c=this.nb;c.activeTexture(c.TEXTURE2);c.bindTexture(c.TEXTURE_2D,a);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,t);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,b);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D, c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.bindTexture(c.TEXTURE_2D,q)},ga:function(){var a=this;A.V(this.Rb,Tk.iG,function(b){if(!a.Xn.Tg){a.XH=[a.W.Ja().heading,a.W.Ja().pitch];var c=Uk(b),e=c.x*a.Hc,b=c.y*a.Hc,f=q;a.Pi&&(f=a.Iz(e,b));a.S1=[e,b];a.CH=f;if(f!==q){a.W.dispatchEvent(new P("onlinktouchstart"));a.RT=setTimeout(function(){if(!a.hi){for(var b=a.ha.links,i=0;i<b.length;i++)if(b[i].id=== f){a.QG=b[i].dir;a.gb=i;break}a.BH=p;a.md=p;a.W.md=p;b=[e,(c.y-60)*a.Hc];a.tn=a.Cn(b);a.qn=a.Yy(b);a.W.dispatchEvent(new P("onrefresh"));a.W.dispatchEvent(new P("onlongjumpstart"))}},300)}}});A.V(this.Rb,Tk.ZF,function(){clearTimeout(a.RT);if(!a.Xn.Tg){var b=a.W.Ja();a.cJ=Math.abs(Math.round(a.XH[0])-Math.round(b.heading))>1||Math.abs(Math.round(a.XH[1])-Math.round(b.pitch))>1?t:p;a.Xn.KN(a.gb);if(a.md){a.md=a.hi;a.W.md=a.hi;if(!a.hi)a.BH=t;if(!a.hi||a.cJ){var c=a.QG,e=a.Yy();if(e<5){a.W.dispatchEvent(new P("onrefresh")); a.W.dispatchEvent(new P("onlongjumpcancel"))}else{b=a.ha.ph+Math.sin(U(c))*e;c=a.ha.qh+Math.cos(U(c))*e;a.W.dispatchEvent(new P("onrefresh"));a.W.dispatchEvent(new P("onlongjumpend"));b=new Q(b,c);a.W.va(a.Vd.nh(b),{hk:p});a.xy(0,t)}}}else if(a.cJ&&a.ha&&a.CH){a.W.dispatchEvent(new P("onlinkclick"));a.W.Cc(a.CH,{hk:p});a.W.dispatchEvent(new P("onlinktouchend"))}}});A.V(this.Rb,Tk.gG,function(b){if(!a.Xn.Tg&&a.ha){var c=q,e=q,f=q,g=q,i=t;if(!(!a.md&&!a.hi||a.ha.breakId||!a.Jj)){e=Uk(b);f=e.x*a.Hc; g=e.y*a.Hc;b=a.Cn([f,g]);if(a.hi){if(a.Pi){f=e.x*a.Hc;g=e.y*a.Hc;(c=a.Iz(f,g))&&(i=p)}if(!b){a.md=t;a.W.md=t;return}if(!a.md){a.md=p;a.W.md=p}c=a.XS(b);if(c!==-1){a.gb=c;a.QG=a.ha.links[c].dir;var k=Math.sqrt(b[0]*b[0]+b[2]*b[2])}}a.qn=a.Yy([f,g]);k=a.qn*9/k;f=Math.acos(k);g=(g=a.iH())&&g.roadWidth?g.roadWidth/100:5;if(f&&a.hi)if(g>Math.abs(Math.sin(f)*a.qn)&&!i){a.md=p;a.W.md=p}else{a.md=t;a.W.md=t;a.xy(0,t)}if(a.qn<5&&a.hi){a.md=t;a.W.md=t}a.xy(a.qn,p,e);a.W.dispatchEvent(new P("onrefresh"))}}})}, dS:function(a,b){var c=a[2],e=[(b[0]+b[3]+b[6]+b[9])/4,(b[2]+b[5]+b[8]+b[11])/4];return Math.abs(a[0]-e[0])<12&&Math.abs(c-e[1])<12?p:t},iH:function(){return this.ha.links.length<1||!this.ha.links[this.gb]?q:this.ha.links[this.gb]},XS:function(a){if(a){for(var b=this.ha.links,c=[0,0],c=0,e=-Infinity,f=-1,a=[a[0],a[2]],g=0;g<b.length;g++){c=U(b[g].refinedDir);c=[Math.sin(c),-Math.cos(c)];theta=a[0]*c[0]+a[1]*c[0];f=e<theta?g:f;e=e<theta?theta:e}return f}},Iz:function(a,b){if(!this.Pi||!this.nA||!this.nA.length)return q; var c=this.nA[1],e=this.Cn([a,b],c[1]);if(!e)return q;for(var f=0,g=this.ha.links.length;f<g;f++){var i=c.slice(f*12,f*12+12);if(this.dS(e,i)){this.gb=f;break}}return this.ha.links[f]?this.ha.links[f].id:q},wL:function(a,b){if(this.ha.links.length===0||this.Jj===t)return 0;var c=this.Cn([a,b]),e=t;if(!c){e=this.W.ja();c=this.Cn([a,b+50*Math.pow(2,e-2)]);if(!c)return 0;e=p}for(var f=this.W.Ja().heading;f<0;)f=f+360;var f=this.fR(f%360),g=this.ha.links[f].refinedDir,i=Math.sin(U(g)),g=Math.cos(U(g)), k=-i*c[0]+g*c[2];if(k>100||k<-100)return 0;c=(g*c[0]+i*c[2])/9;if(c<3.6)return 0;i=this.ha.links[f];g=this.aQ([this.ha.ph,0,this.ha.qh],[i.x,0,i.y]);this.Xn.KN(f);if(c<g){this.W.Cc(i.id,{hk:p});this.W.dispatchEvent(new P("onclickonroad"));return c}c>300&&(c=300);e&&(c=300);f=this.ha.links[f].dir;e=this.ha.ph+Math.sin(U(f))*c;f=this.ha.qh+Math.cos(U(f))*c;this.W.dispatchEvent(new P("onclickonroad"));this.W.va(this.Vd.nh(new Q(e,f)),{hk:p});return c},Yy:function(a){var b=this.tn,c=this.iH();a&&(b=this.Cn(a)); if(!b)return 300;if(!c)return 0;var e=c.refinedDir,c=Math.sin(U(e)),f=Math.cos(U(e)),a=Math.sin(U(-e)),e=Math.cos(U(-e)),g=f*b[0]+c*b[2],c=-c*b[0]+f*b[2];c>70&&(c=70);c<-70&&(c=-70);b[0]=e*g+a*c;b[2]=-a*g+e*c;this.tn[0]=b[0];this.tn[2]=b[2];b=g/9;return b>300?300:b},fR:function(a){for(var b=360,c=-1,e=0;e<this.ha.links.length;e++){var f=Math.abs(a-this.ha.links[e].dir);if(f<b){b=f;c=e}}e=c==this.ha.links.length-1?0:c+1;f=this.ha.links[e].dir;if(f<this.ha.links[c].dir){f=Math.abs(a-(f+360));if(f<b)return e}e= c==0?this.ha.links.length-1:c-1;f=this.ha.links[e].dir;if(f>this.ha.links[c].dir){f=Math.abs(360+a-f);if(f<b)return e}return c},aQ:function(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[2]-b[2],2))},Fz:function(){var a=this.ne,b=this.nb;a.jt=b.getUniformLocation(a,"uPMatrix");a.ft=b.getUniformLocation(a,"uMVMatrix");a.alpha=b.getUniformLocation(a,"uAlpha");a.color=b.getUniformLocation(a,"uColor");a=this.Vu;a.jt=b.getUniformLocation(a,"uPMatrix");a.ft=b.getUniformLocation(a,"uMVMatrix");a.TZ= b.getUniformLocation(a,"uSampler")},Gz:function(){var a=this.ne,b=this.nb;a.Xm=b.getAttribLocation(a,"aVertexPosition");a=this.Vu;a.Xm=b.getAttribLocation(a,"aVertexPosition");a.bu=b.getAttribLocation(a,"aVertexTextureCoord")},ZA:function(){var a=this.ne,b=this.nb;b.uniformMatrix4fv(a.jt,t,this.Kh);b.uniformMatrix4fv(a.ft,t,this.zA)},za:u(),setData:function(a){if(this.ha=a){this.Sd={};this.LQ=this.ha.tiles.dirNorth;this.Ua=p}},qv:function(a,b,c,e){if(this.nb&&this.Ua&&this.ha){this.nb.useProgram(this.ne); this.Kh=a;this.zA=b;this.Uq=c;this.KS=e;this.ZA();this.mb()}},mb:function(){if(this.Kh&&this.zA){var a=this.gT(),b=this.nb,c=this.ne,e=this.Vu;b.depthMask(t);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);var f=this.Sv;f.ND();f.Eo(c.Xm);f.oC();if(this.md&&this.Jj){c=0.6;this.qn<5&&(c=this.hi?-0.3:0.2);this.vq(this.IG.uc,this.IG.kD(),this.tn,1,c,t);this.vq(this.wI.uc,this.wI.kD(),this.tn,1,c+0.3,t)}else this.xy(0,t);if(!(this.BH||this.Pi===t)){var c=a[0],g=a[1],i=a[2],k=a[3],m=a[4],n=a[5],a=a[6];b.blendFuncSeparate(b.SRC_ALPHA, b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);b.activeTexture(b.TEXTURE2);b.useProgram(e);f.ND();f.Eo(e.Xm);f.Eo(e.bu);f.oC();b.uniformMatrix4fv(e.jt,t,this.Kh);b.uniformMatrix4fv(e.ft,t,this.zA);b.uniform1i(e.TZ,2);if(this.hn){b.bindTexture(b.TEXTURE_2D,this.hn);this.vq(c,k,q,1,1,p,m)}if(this.kn){b.bindTexture(b.TEXTURE_2D,this.kn);this.vq(g,k,q,1,1,p,m)}if(this.jn){b.bindTexture(b.TEXTURE_2D,this.jn);this.vq(i,n,q,1,1,p,a)}b.depthMask(p)}}},xy:function(a,b,c){if(q===this.Dr){this.Dr=document.createElement("span"); this.Dr.style.cssText="font: 13px Microsoft YaHei,SimHei,Apple LiSung Light;color: #FFFFFF;position:absolute;z-index: 9999";this.W.Ra().append(this.Dr)}var e=this.Dr;if(p===b&&p===this.md&&l!==a&&!isNaN(a)&&l!==c&&a>5){e.style.display="inline";b=parseInt(c.x,10)-20;e.style.top=parseInt(c.y,10)+20+"px";e.style.left=b+"px";e.innerHTML="\\u524d\\u8fdb"+parseInt(a,10)+"\\u7c73"}else e.style.display="none"},gT:function(){for(var a=[],b=[],c=[],e=[],f=[],g=Vk.length/3,i=this.W.Ja().heading+this.LQ;i<0;)i= i+360;var k=this.W.Ja().pitch,i=I()?30:60,m=-30,n=this.Xn.Rh||this.W.ja(),i=i+20*n;if(k<0){k=Math.abs(k);i=i*((90-k)/90);m=m-20*k/90}for(k=0;k<this.ha.links.length;k++){var o=this.ha.links[k].refinedDir,s=Math.cos(U(o))*i,v=Math.sin(U(o))*i,n=qk.create();qk.tm(n);qk.rotate(n,n,U(o-90),[0,1,0]);for(var o=[s,m,v],s=Vk,v=Xk,w=0;w<g;w++){var y=this.FG(n,s,w*3);a.push(y[0]+o[0],o[1]-1,y[2]+o[2]);b.push(y[0]+o[0],o[1],y[2]+o[2]);y=this.FG(n,v,w*3);c.push(y[0]+o[0],o[1],y[2]+o[2])}}g=this.ZP(e,[],f,[]); return this.nA=a=[a,b,c,e,g[0],f,g[1]]},ZP:function(a,b,c,e){for(var f=0;f<this.ha.links.length;f++){var g=f*4;a.push(g,g+1,g+2);a.push(g,g+2,g+3);c.push(g,g+1,g+3);c.push(g+2,g+3,g+1);b=b.concat(Wk);e=e.concat(this.zR(this.ha.links[f].dir))}return[b,e]},FG:function(a,b,c){return[a[0]*b[c]+a[1]*b[c+1]+a[2]*b[c+2],0,a[8]*b[c]+a[9]*b[c+1]+a[10]*b[c+2]]},vq:function(a,b,c,e,f,g,i){var k=this.nb,m=this.ne;if(g)m=this.Vu;var n=[0,0,0],o=[];if(c){n[0]=c[0];n[2]=c[2];for(var s=0;s<a.length/3;s++){var v= s*3;o.push(a[v]+n[0],c[1],a[v+2]+n[2])}}else o=a;if(g){if(!this.Nl)this.Nl=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,this.Nl);k.bufferData(k.ARRAY_BUFFER,new Float32Array(i),k.STATIC_DRAW);k.vertexAttribPointer(m.bu,2,k.FLOAT,t,0,0)}else{k.uniform1f(m.color,e);k.uniform1f(m.alpha,f)}if(!this.OH)this.OH=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,this.OH);k.bufferData(k.ARRAY_BUFFER,new Float32Array(o),k.STATIC_DRAW);if(!this.bv)this.bv=k.createBuffer();k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,this.bv); k.bufferData(k.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),k.STATIC_DRAW);this.bv.DF=b.length;k.vertexAttribPointer(m.Xm,3,k.FLOAT,t,0,0);k.drawElements(k.TRIANGLES,this.bv.DF,k.UNSIGNED_SHORT,0)},Cn:function(a,b){var c=this.Uq,e=this.KS;if(c){var f=a[0],g=a[1],i=this.Vi,k=this.Pj,m=pk.create(),f=pk.ug(f*2/i-1,1-g*2/k,-1,1);qk.multiply(m,c,f);qk.multiply(m,e,m);c=m[0]*200;e=m[1]*200;m=m[2]*200;f=(b||-20)/e;if(!(f<0))return[c*f,e*f,m*f]}},Kk:function(){this.Vi=this.Rb.width;this.Pj=this.Rb.height},zR:function(a){var b= Math.ceil(Math.floor((a+360)%360/22.5)/2);b===8&&(b=0);for(var a=Yk.slice(0),c=Math.floor(b/2),b=b%2,e=0;e<a.length;e++)a[e]=e%2==0?a[e]+c*0.25:a[e]+b*0.5;return a},iV:function(){this.Sd={}},show:function(){this.Pi=p},$:function(){this.Pi=t},DC:function(){this.Jj=p},lC:function(){this.Jj=t},hC:function(){this.iV();var a=this.nb;a.deleteTexture(this.hn);a.deleteTexture(this.kn);a.deleteTexture(this.jn);this.jn=this.kn=this.hn=q}}); ');
